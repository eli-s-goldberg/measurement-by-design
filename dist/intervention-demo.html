<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.0">
<title>Intervention Demo | Measurement By Design</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.dcdbf18e.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.dcdbf18e.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.f8e00754.js">
<link rel="modulepreload" href="./_observablehq/runtime.9393ab6d.js">
<link rel="modulepreload" href="./_observablehq/stdlib.95bfbf7e.js">
<link rel="modulepreload" href="./_import/components/styles.5ae71931.js">
<link rel="modulepreload" href="./_import/components/generateHealthcareData.59569be6.js">
<link rel="modulepreload" href="./_import/components/ml-utils.49f0e6d0.js">
<link rel="modulepreload" href="./_node/d3-require@1.3.0/index.45152b81.js">
<link rel="modulepreload" href="./_import/components/FunnelChart.56736e39.js">
<link rel="modulepreload" href="./_import/components/TreeExplore.d56586fd.js">
<link rel="modulepreload" href="./_import/components/AggStats.7b40fa2c.js">
<link rel="modulepreload" href="./_import/components/SankeyFlow.0b51f987.js">
<link rel="modulepreload" href="./_import/components/RandomForestClassifier.1e680409.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/063eb405.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.d397b6a8.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/e828d8c8.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/7055d4c5.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/a62ae5ce.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/d44feff9.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/5830b12a.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/84d7b8e9.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/626bedc4.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/b22c5864.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/6f15f633.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/ef1ec490.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/bbafde58.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/32c7fec2.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/cf9b720b.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/5dcd62f4.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/8debb4ba.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/4b0cc581.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/1ee6c50d.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<script type="module">

import {define} from "./_observablehq/client.f8e00754.js";

define({id: "7a72c493", inputs: ["html"], outputs: ["defaultStyles","styleElement","d3"], body: async (html) => {
const [{defaultStyles}, d3] = await Promise.all([import("./_import/components/styles.5ae71931.js"), import("https://cdn.jsdelivr.net/npm/d3@7/+esm")]);
// import some CSS to keep things well styled
const styleElement = html`<style>
  ${defaultStyles}
</style>`;
document.head.appendChild(styleElement);

return {defaultStyles,styleElement,d3};
}});

define({id: "7381e00e", outputs: ["generateHealthcareData","CONSTANTS","calculateImageUse","prepareImagingData","stratifiedSubsample","getRandomSubsample","computeMeanAndCI","computeROC","require","FunnelChart","createTreeWithStats","calculateStats","createFunnelData","formatNumber","createMulticlassMetric","createRateMetric","createDemographicMetrics","aggregateData","createDataSummary","createIntMetric","createFloatMetric","createSankeyFlow","RandomForestClassifier"], body: async () => {
const [{generateHealthcareData, CONSTANTS, calculateImageUse}, {prepareImagingData, stratifiedSubsample, getRandomSubsample, computeMeanAndCI, computeROC}, {require}, {FunnelChart}, {createTreeWithStats, calculateStats, createFunnelData, formatNumber}, {createMulticlassMetric, createRateMetric, createDemographicMetrics, aggregateData, createDataSummary, createIntMetric, createFloatMetric}, {createSankeyFlow}, {RandomForestClassifier}] = await Promise.all([import("./_import/components/generateHealthcareData.59569be6.js"), import("./_import/components/ml-utils.49f0e6d0.js"), import("./_node/d3-require@1.3.0/index.45152b81.js"), import("./_import/components/FunnelChart.56736e39.js"), import("./_import/components/TreeExplore.d56586fd.js"), import("./_import/components/AggStats.7b40fa2c.js"), import("./_import/components/SankeyFlow.0b51f987.js"), import("./_import/components/RandomForestClassifier.1e680409.js")]);
// import data gen and consts


return {generateHealthcareData,CONSTANTS,calculateImageUse,prepareImagingData,stratifiedSubsample,getRandomSubsample,computeMeanAndCI,computeROC,require,FunnelChart,createTreeWithStats,calculateStats,createFunnelData,formatNumber,createMulticlassMetric,createRateMetric,createDemographicMetrics,aggregateData,createDataSummary,createIntMetric,createFloatMetric,createSankeyFlow,RandomForestClassifier};
}});

define({id: "32076022", inputs: ["generateHealthcareData"], outputs: ["DATASETSIZE","data"], body: (generateHealthcareData) => {
// Generate a dataset for analysis
const DATASETSIZE = 54000;
const data = generateHealthcareData(DATASETSIZE);
return {DATASETSIZE,data};
}});

define({id: "cc43493b", mode: "inline", inputs: ["DATASETSIZE","display"], body: async (DATASETSIZE,display) => {
display(await(
DATASETSIZE.toLocaleString()
))
}});

define({id: "2804730b", inputs: ["createDataSummary","data","Inputs","view"], outputs: ["summary","headersDictSumm","tableSummary"], body: (createDataSummary,data,Inputs,view) => {
// use dataset summarization
const summary = createDataSummary(data);

// Create headers dictionary
const headersDictSumm = summary.columns.reduce((acc, c) => {
  acc[c.field] = c.header;
  return acc;
}, {});

// Use with Inputs.table
const tableSummary = Inputs.table(summary.data, {
  columns: summary.columns.map((c) => c.field),
  header: headersDictSumm,
  rows: 18,
  maxWidth: 1000,
  multiple: false,
  layout: "auto",
});

// Show table summary
view(tableSummary);
return {summary,headersDictSumm,tableSummary};
}});

define({id: "3aa0b534", inputs: ["Inputs","data"], outputs: ["rawData"], body: (Inputs,data) => {
// Let's view it as a table
const rawData = Inputs.table(data, {
  width: {
    ID: 50,
    Age: 80,
    Gender: 75,
    Region: 100,
    PlanType: 100,
    Diagnosis: 100,
    PrimaryCareEngagement: 50,
    SmokingStatus: 100,
    IncomeBracket: 100,
    ImagingVisits: 50,
    Non_Preferred_Imaging_Visits: 50,
  },
  // Column alignments
  align: {
    ID: "left",
    Age: "right",
    Gender: "center",
    Region: "center",
    PlanType: "left",
    Diagnosis: "center",
    PrimaryCareEngagement: "center",
    SmokingStatus: "center",
    IncomeBracket: "center",
    ImagingVisits: "right",
    Non_Preferred_Imaging_Visits: "right",
  },
  // Human-readable headers
  header: {
    ID: "Id",
    Age: "Age",
    Gender: "Sex",
    Region: "Region",
    PlanType: "Plan Type",
    Diagnosis: "Dx",
    PrimaryCareEngagement: "PCP",
    SmokingStatus: "Smoker",
    IncomeBracket: "Income",
    ImagingVisits: "Img. Visits",
    NonPreferredVisits: "Non-Pref. Img.",
  },
  rows: 18, // Number of rows displayed at once
  maxWidth: 900, // Maximum width of the table
  multiple: false, // Single row selection
  layout: "auto", // Auto table layout
});

// view(rawData)
return {rawData};
}});

define({id: "acbc38fb", inputs: ["d3","data","view","Plot","formatNumber"], outputs: ["disttotals","plotDistData","frac_non_pref_of_total"], body: (d3,data,view,Plot,formatNumber) => {
// let's do a bit of aggregating
const disttotals = {
  "Total Imaging": d3.sum(data, (d) => d.ImagingVisits),
  "Non-Preferred": d3.sum(data, (d) => d.NonPreferredVisits),
};

// Create data array for plotting
const plotDistData = Object.entries(disttotals).map(([key, value]) => ({
  category: key,
  value: value,
}));

// Updated plot with scaling
view(
  Plot.plot({
    marginLeft: 90,
    height: 100,
    x: {
      label: "Number of Visits (Millions)",
      transform: (d) => d / 1000000,
    },
    y: {
      label: null,
    },
    color: {
      range: ["#FFB600", "#D04A02"],
      // legend: true
    },
    marks: [
      Plot.barX(plotDistData, {
        x: "value",
        y: "category",
        fill: "category",
        sort: { y: "-x" },
      }),
      Plot.ruleX([0]),
      Plot.text(plotDistData, {
        x: "value",
        y: "category",
        text: (d) => formatNumber(d.value, "millions"),
        textAnchor: "end",
        dx: -4,
        fill: (d) => (d.category === "Total Imaging" ? "white" : "black"),
        font: "bold 12px sans-serif",
      }),
    ],
  })
);

const frac_non_pref_of_total = (
  (disttotals["Non-Preferred"] / disttotals["Total Imaging"]) *
  100
).toFixed(2);
return {disttotals,plotDistData,frac_non_pref_of_total};
}});

define({id: "45aee45f", mode: "inline", inputs: ["frac_non_pref_of_total","display"], body: async (frac_non_pref_of_total,display) => {
display(await(
frac_non_pref_of_total
))
}});

define({id: "f2c14118", inputs: ["view","Inputs"], outputs: ["DIMENSIONS","selectedDimension"], body: (view,Inputs) => {
// set dimensions for dropdown.
const DIMENSIONS = [
  { value: "PlanType", label: "Plan Type" },
  { value: "Region", label: "Region" },
  { value: "PrimaryCareEngagement", label: "Primary Care Engagement" },
  { value: "SmokingStatus", label: "Smoking Status" },
  { value: "IncomeBracket", label: "Income Bracket" },
];

// Create the dimension selector
const selectedDimension = view(
  Inputs.select(DIMENSIONS, {
    label: "Select Dimension",
    format: (d) => d.label, // Display the label in the dropdown
    value: DIMENSIONS[0], // Default to first option
  })
);
return {DIMENSIONS,selectedDimension};
}});

define({id: "16b3a8c6", inputs: ["calculateImageUse","data","selectedDimension","view","Plot"], outputs: ["imageUseData"], body: (calculateImageUse,data,selectedDimension,view,Plot) => {
// Generate data based on selection
const imageUseData = calculateImageUse(data, selectedDimension.value);

// plot it
view(
  Plot.plot({
    marginLeft: 10,
    marginRight: 80,
    x: {
      label: "Percentage of Visits",
      grid: false,
      nice: true,
    },
    y: {
      label: null,
      nice: true,
    },
    color: {
      range: ["#FFB600", "#D04A02"],
      legend: true,
    },
    facet: {
      data: imageUseData,
      marginRight: 30,
      x: selectedDimension.value,
      y: "diagnosis",
      label: "",
      labelAnchor: "middle",
    },
    marks: [
      Plot.barX(imageUseData, {
        x: "value",
        y: "planType",
        fill: "category",
        sort: { y: "-x" },
        fx: selectedDimension.value,
        fy: "diagnosis",
      }),
      Plot.ruleX([0]),
      // Non-preferred text
      Plot.text(
        imageUseData.filter((d) => d.category === "Non-Preferred"),
        {
          x: (d) => 100 - d.value,
          y: "planType",
          text: (d) => `${d.value.toFixed(1)}%`,
          textAnchor: "end",
          dx: -2,
          fill: "white",
          font: "bold 10px sans-serif",
          fx: selectedDimension.value,
          fy: "diagnosis",
        }
      ),
    ],
  })
);
return {imageUseData};
}});

define({id: "9304763a", mode: "inline", inputs: ["copd_membership","display"], body: async (copd_membership,display) => {
display(await(
copd_membership
))
}});

define({id: "92165dd9", mode: "inline", inputs: ["copd_frac","display"], body: async (copd_frac,display) => {
display(await(
copd_frac
))
}});

define({id: "a8117185", mode: "inline", inputs: ["total_membership","display"], body: async (total_membership,display) => {
display(await(
total_membership
))
}});

define({id: "01efc58f", mode: "inline", inputs: ["copd_non_pref_to_total_imaging_visits","display"], body: async (copd_non_pref_to_total_imaging_visits,display) => {
display(await(
copd_non_pref_to_total_imaging_visits
))
}});

define({id: "c08287ae", mode: "inline", inputs: ["copd_non_pref_imaging_membership","display"], body: async (copd_non_pref_imaging_membership,display) => {
display(await(
copd_non_pref_imaging_membership
))
}});

define({id: "9d079de2", inputs: ["data"], outputs: ["copd_membership","copd_non_pref_imaging","copd_non_pref_imaging_membership","copd_total_imaging","total_membership","copd_frac","copd_non_pref_to_total_imaging_visits"], body: (data) => {
// members with copd (calc)
const copd_membership = data.filter((d) => d.Diagnosis === "COPD").length;

const copd_non_pref_imaging = data
  .filter((d) => d.Diagnosis === "COPD")
  .map((d) => d.NonPreferredVisits)
  .reduce((acc, val) => acc + val, 0);

const copd_non_pref_imaging_membership = data.filter(
  (d) => d.Diagnosis === "COPD" && d.NonPreferredVisits > 0
).length;

const copd_total_imaging = data
  .filter((d) => d.Diagnosis === "COPD")
  .map((d) => d.ImagingVisits)
  .reduce((acc, val) => acc + val, 0);

const total_membership = data.length;
const copd_frac = `${((copd_membership / total_membership) * 100).toFixed(2)}%`;
const copd_non_pref_to_total_imaging_visits = `${(
  (copd_non_pref_imaging / copd_total_imaging) *
  100
).toFixed(2)}%`;
return {copd_membership,copd_non_pref_imaging,copd_non_pref_imaging_membership,copd_total_imaging,total_membership,copd_frac,copd_non_pref_to_total_imaging_visits};
}});

define({id: "624df75f", inputs: ["data","total_membership"], outputs: ["rural_membership","rural_membership_fraction_display","rural_membership_fraction","rural_COPD_membership","rural_COPD_membership_fraction","rural_membership_non_pref","rural_membership_non_pref_fraction","rural_membership_non_pref_COPD","rural_membership_non_pref_COPD_fraction","rural_imaging_total","rural_imaging_total_non_pref","rural_copd_total_imaging","rural_copd_total_imaging_non_pref","funnel_data"], body: (data,total_membership) => {
const rural_membership = data.filter((d) => d.Region === "Rural").length;

const rural_membership_fraction_display = `${(
  (rural_membership / total_membership) *
  100
).toFixed(2)}%`;
const rural_membership_fraction = (rural_membership / total_membership) * 100;

const rural_COPD_membership = data.filter(
  (d) => d.Diagnosis === "COPD" && d.Region === "Rural"
).length;

const rural_COPD_membership_fraction = rural_COPD_membership / total_membership;

const rural_membership_non_pref = data.filter(
  (d) => d.Region === "Rural" && d.NonPreferredVisits > 0
).length;
const rural_membership_non_pref_fraction =
  rural_membership_non_pref / total_membership;

const rural_membership_non_pref_COPD = data.filter(
  (d) =>
    d.Region === "Rural" && d.Diagnosis === "COPD" && d.NonPreferredVisits > 0
).length;
const rural_membership_non_pref_COPD_fraction =
  rural_membership_non_pref_COPD / total_membership;

const rural_imaging_total = data
  .filter((d) => d.Region === "Rural")
  .map((d) => d.ImagingVisits)
  .reduce((acc, val) => acc + val, 0);

const rural_imaging_total_non_pref = data
  .filter((d) => d.Region === "Rural")
  .map((d) => d.NonPreferredVisits)
  .reduce((acc, val) => acc + val, 0);

const rural_copd_total_imaging = data
  .filter((d) => d.Diagnosis === "COPD" && d.Region === "Rural")
  .map((d) => d.ImagingVisits)
  .reduce((acc, val) => acc + val, 0);

const rural_copd_total_imaging_non_pref = data
  .filter((d) => d.Diagnosis === "COPD" && d.Region === "Rural")
  .map((d) => d.NonPreferredVisits)
  .reduce((acc, val) => acc + val, 0);

const funnel_data = [
  {
    group: "Total Membership",
    value: (total_membership / total_membership) * 100,
    altValue: `${total_membership} members`,
  },
  {
    group: "Rural Membership",
    value: Number(rural_membership_fraction).toFixed(2),
    altValue: `${rural_membership} members`,
  },
  {
    group: "Rural Membership with COPD",
    value: Number(rural_COPD_membership_fraction * 100).toFixed(2),
    altValue: `${rural_COPD_membership} members`,
  },
  {
    group: "Rural Membership with COPD that drive non-preferred ",
    value: Number(rural_membership_non_pref_COPD_fraction * 100).toFixed(2),
    altValue: `${rural_membership_non_pref_COPD} members`,
  },
];
return {rural_membership,rural_membership_fraction_display,rural_membership_fraction,rural_COPD_membership,rural_COPD_membership_fraction,rural_membership_non_pref,rural_membership_non_pref_fraction,rural_membership_non_pref_COPD,rural_membership_non_pref_COPD_fraction,rural_imaging_total,rural_imaging_total_non_pref,rural_copd_total_imaging,rural_copd_total_imaging_non_pref,funnel_data};
}});

define({id: "c25a83a3", inputs: ["view","Inputs"], outputs: ["columnMap","columnOrder"], body: (view,Inputs) => {
const columnMap = {
  Region: "Region",
  PlanType: "PlanType",
  Diagnosis: "Diagnosis",
  SmokingStatus: "SmokingStatus",
  Gender: "Gender",
  IncomeBracket: "IncomeBracket",
  PrimaryCareEngagement: "PrimaryCareEngagement",
};
const columnOrder = view(
  Inputs.checkbox(Object.keys(columnMap), {
    label: "Multi-Select",
    value: ["Region", "PlanType", "Diagnosis", "SmokingStatus"],
  })
);
return {columnMap,columnOrder};
}});

define({id: "ec8b0fa2", mode: "inline", inputs: ["columnOrder","display"], body: async (columnOrder,display) => {
display(await(
Array.from(columnOrder).join(', ')
))
}});

define({id: "753b8af0", inputs: ["createTreeWithStats","data","columnOrder","columnMap","view"], outputs: ["stroke_width_divisor","combinedViz"], body: (createTreeWithStats,data,columnOrder,columnMap,view) => {
// Usage

const stroke_width_divisor = 50000;
const combinedViz = createTreeWithStats(
  data,
  columnOrder,
  columnMap,
  stroke_width_divisor
);
view(combinedViz);
return {stroke_width_divisor,combinedViz};
}});

define({id: "f8ff7627", inputs: ["createMulticlassMetric","createRateMetric","createIntMetric","createFloatMetric","aggregateData","data","Inputs","view"], outputs: ["dimensions","metrics","results","headersDict","table"], body: (createMulticlassMetric,createRateMetric,createIntMetric,createFloatMetric,aggregateData,data,Inputs,view) => {
// Define dimensions
const dimensions = ["Region", "PlanType", "Diagnosis", "SmokingStatus"];

// Create Custom
const metrics = [
  ...createMulticlassMetric("Gender", ["Female", "Male"], {
    includeRates: true,
  }),
  ...createRateMetric(
    "PrimaryCareEngagement",
    (row) => row.PrimaryCareEngagement === "Yes",
    { header: "PCP Engagement Rate" }
  ),
  ...createMulticlassMetric("PrimaryCareEngagement", ["Yes", "No"], {
    header: "PCP Engagement",
  }),
  ...createIntMetric("ImagingVisits", {
    header: "Imaging Visits",
    precision: 1,
    weightedAverage: false,
    aggregation: "sum",
  }),
  ...createFloatMetric("Age", {
    header: "Average Age",
    aggregation: "average",
    precision: 1,
  }),
];

// Get results
const results = aggregateData(data, dimensions, metrics);

const headersDict = results.columns.reduce((acc, c) => {
  acc[c.id] = c.name;
  return acc;
}, {});

const table = Inputs.table(results.data, {
  columns: results.columns.map((c) => c.id),
  header: headersDict,
  rows: 18, // Number of rows displayed at once
  maxWidth: 1000, // Maximum width of the table
  multiple: false, // Single row selection
  layout: "auto", // Auto table layout
});

view(table);
return {dimensions,metrics,results,headersDict,table};
}});

define({id: "649c196a", inputs: ["view","Inputs","createSankeyFlow"], outputs: ["sankeydata","config","replay","node","replayFn"], body: (view,Inputs,createSankeyFlow) => {
const sankeydata = {
  root: {
    "copd control": {
      // Group without intervention
      a: { preferred: 300, non_preferred: 198 },
    },
    "COPD intervention": {
      // Group with intervention
      b: { preferred: 280, non_preferred: 218 },
      bb: { preferred: 390, non_preferred: 172 },
    },
  },
};

const config = {
  width: 800,
  height: 300,
  particleSize: 6,
  particleSpeed: 5,
  particleSpawnRate: 0.4,
  particleVerticalSpread: 0.8,
  hideRootLabel: true,
  counterSpacing: 100,
  nodePadding: 30,
  margin: { top: 20, right: 250, bottom: 20, left: 40 },
  bucketColors: {
    preferred: "#FFB600",
    non_preferred: "#D04A02",
  },
};

const replay = view(Inputs.button("Replay"));
const { node, replay: replayFn } = createSankeyFlow(sankeydata, config);
view(node);
return {sankeydata,config,replay,node,replayFn};
}});

define({id: "d8abab8c", inputs: ["replay","replayFn"], body: (replay,replayFn) => {
replay; // This will trigger the replay when the button is clicked
replayFn();
}});

define({id: "09d94069", inputs: ["prepareImagingData","RandomForestClassifier","Plot"], outputs: ["trainModel"], body: (prepareImagingData,RandomForestClassifier,Plot) => {
// introduce training model loop
function trainModel(data, params) {
  const { X, y, featureNames } = prepareImagingData(data);
  const clf = new RandomForestClassifier({
    nEstimators: params.nEstimators,
    maxDepth: params.maxDepth,
    minSize: params.minSize,
    sampleSize: params.sampleSize,
    maxFeatures: params.maxFeatures,
    decimalPrecision: params.decimalPrecision,
  });

  clf.fit(X, y);
  const yPred = clf.predict(X);
  const proba = clf.predictProba(X);
  const confusionMatrix = clf.confusionMatrix(y, yPred);
  const labels = confusionMatrix.labels;
  const accuracy = clf.round(clf.accuracyScore(y, yPred));
  const recall = clf.round(clf.recallScore(y, yPred));
  const precision = clf.round(clf.precisionScore(y, yPred));

  const confusionData = [];
  for (let i = 0; i < labels.length; i++) {
    for (let j = 0; j < labels.length; j++) {
      confusionData.push({
        true_label: labels[i],
        predicted_label: labels[j],
        count: confusionMatrix.matrix[i][j],
      });
    }
  }

  // confusion matrix plot
  const confusionPlot = Plot.plot({
    padding: 0,
    grid: true,
    x: {
      axis: "top",
      label: "Predicted Label",
      domain: labels, // Ensure the x-axis includes all labels
      tickFormat: (d) => d.toString(),
    },
    y: {
      label: "True Label",
      domain: labels, // Ensure the y-axis includes all labels
      tickFormat: (d) => d.toString(),
    },
    color: {
      type: "linear",
      scheme: "Blues",
      label: "Count",
    },
    width: 200,
    height: 200,
    marks: [
      // Cells representing counts
      Plot.cell(confusionData, {
        x: "predicted_label",
        y: "true_label",
        fill: "count",
        inset: 0.5,
        title: (d) =>
          `True: ${d.true_label}, Predicted: ${d.predicted_label}, Count: ${d.count}`,
      }),
      // Text labels showing counts
      Plot.text(confusionData, {
        x: "predicted_label",
        y: "true_label",
        text: (d) => d.count.toString(),
        fill: (d) => (d.count > 0 ? "black" : "gray"),
        textAnchor: "middle",
        stroke: "white",
        size: 10,
        dy: 5,
      }),
    ],
  });

  // AUC plot w/ roc curve

  // 1. Get probability estimates

  // 2. Extract probabilities for the positive class (assuming class '1')
  const yScores = proba.map((probs) => probs[1]);

  // 3. Ensure yTrue is an array of numbers
  const yTrue = y.map((label) => Number(label));

  // 4. Compute ROC curve
  function computeROC(yTrue, yScores, positiveClass = 1) {
    const data = yTrue.map((trueLabel, index) => ({
      trueLabel,
      score: yScores[index],
    }));

    data.sort((a, b) => b.score - a.score);

    let tp = 0;
    let fp = 0;
    const tpr = [];
    const fpr = [];
    const thresholds = [];

    const posCount = yTrue.filter((label) => label === positiveClass).length;
    const negCount = yTrue.length - posCount;

    for (let i = 0; i < data.length; i++) {
      const { trueLabel } = data[i];
      if (trueLabel === positiveClass) {
        tp += 1;
      } else {
        fp += 1;
      }
      tpr.push(tp / posCount);
      fpr.push(fp / negCount);
      thresholds.push(data[i].score);
    }

    return { fpr, tpr, thresholds };
  }

  const { fpr, tpr, thresholds } = computeROC(yTrue, yScores, 1);

  // 5. Compute AUC
  function computeAUC(fpr, tpr) {
    let auc = 0;
    for (let i = 1; i < fpr.length; i++) {
      const xDiff = fpr[i] - fpr[i - 1];
      const ySum = tpr[i] + tpr[i - 1];
      auc += (xDiff * ySum) / 2;
    }
    return auc;
  }

  const auc = computeAUC(fpr, tpr);

  // 6. Prepare data for plotting
  const rocData = fpr.map((fprValue, index) => ({
    fpr: fprValue,
    tpr: tpr[index],
  }));

  // 7. Plot the ROC curve
  const rocPlot = Plot.plot({
    width: 500,
    height: 500,
    x: {
      label: "False Positive Rate",
      domain: [0, 1],
    },
    y: {
      label: "True Positive Rate",
      domain: [0, 1],
    },
    marks: [
      Plot.line(rocData, { x: "fpr", y: "tpr", stroke: "steelblue" }),
      Plot.ruleY([0, 1], { x: [0, 1], stroke: "gray", strokeDasharray: "2,2" }),
      Plot.text([{ x: 0.6, y: 0.1, text: `AUC = ${clf.round(auc)}` }], {
        x: "x",
        y: "y",
        text: "text",
        fill: "black",
        fontSize: 14,
      }),
    ],
  });

  return {
    clf,
    X,
    y,
    yPred,
    proba,
    featureNames,
    metrics: {
      accuracy,
      recall,
      precision,
      confusionMatrix,
    },
    plot: { confusionPlot: confusionPlot, rocPlot: rocPlot },
  };
}
return {trainModel};
}});

define({id: "a40fbdc5", inputs: ["stratifiedSubsample","trainModel","computeMeanAndCI","computeROC","d3","Plot"], outputs: ["trainMultiModel"], body: (stratifiedSubsample,trainModel,computeMeanAndCI,computeROC,d3,Plot) => {
function trainMultiModel(data, rfParamsForm_Selections) {
  const headers = ["Region", "planType", "Gender", "PrimaryCareEngagement"];
  const sampleSize = 100;
  const RUNS = 5;

  const mlresults = Array.from({ length: RUNS }, () => {
    const subsampledData = stratifiedSubsample(data, headers, sampleSize);
    return trainModel(subsampledData, rfParamsForm_Selections);
  });

  const aucValues = mlresults.map((r) => r.metrics.auc).filter(Boolean);
  const aucStats = computeMeanAndCI(aucValues);

  // Generate confusion matrix
  const avgConfusionMatrix = mlresults
    .reduce((acc, result, idx) => {
      const matrix = result.metrics.confusionMatrix.matrix;
      const matrixTotal = matrix.flat().reduce((sum, val) => sum + val, 0);
      const normalizedMatrix = matrix.map((row) =>
        row.map((val) => val / matrixTotal)
      );
      return idx === 0
        ? normalizedMatrix
        : acc.map((row, i) =>
            row.map((val, j) => val + normalizedMatrix[i][j])
          );
    }, null)
    .map((row) => row.map((val) => (val / RUNS) * 100));

  const labels = ["Preferred", "Non Preferred"];
  const avgConfusionData = avgConfusionMatrix.flatMap((row, trueIndex) =>
    row.map((percent, predictedIndex) => ({
      true_label: labels[trueIndex],
      predicted_label: labels[predictedIndex],
      percent: parseFloat(percent.toFixed(2)),
    }))
  );

  // Generate aggregate ROC curves
  const fprPoints = Array.from({ length: 100 }, (_, i) => i / 99);
  const aggregatedROC = fprPoints.map((targetFpr) => {
    const tprValues = mlresults.map((result) => {
      const yScores = result.proba.map((probs) => probs[1]);
      const yTrue = result.y.map((label) => Number(label));
      const { fpr, tpr } = computeROC(yTrue, yScores, 1);

      // Find closest FPR point and interpolate TPR
      const idx = fpr.findIndex((x) => x >= targetFpr);
      if (idx === -1) return 1;
      if (idx === 0) return tpr[0];

      const x1 = fpr[idx - 1];
      const x2 = fpr[idx];
      const y1 = tpr[idx - 1];
      const y2 = tpr[idx];
      return y1 + ((y2 - y1) * (targetFpr - x1)) / (x2 - x1);
    });

    const meanTpr = d3.mean(tprValues);
    const sortedTpr = [...tprValues].sort(d3.ascending);
    const ciLow = sortedTpr[Math.floor(0.025 * sortedTpr.length)];
    const ciHigh = sortedTpr[Math.ceil(0.975 * sortedTpr.length) - 1];

    return {
      fpr: targetFpr,
      tpr: meanTpr,
      ciLow,
      ciHigh,
    };
  });

  // Create plots
  const avgConfusionPlot = Plot.plot({
    height: 300,
    width: 400,
    marginLeft: 100,
    marginRight: 40,
    inset: 10,
    marginTop: 50,
    padding: 0.1,
    grid: true,
    x: {
      label: "Predicted Label",
      domain: labels,
      tickFormat: (d) => d,
    },
    y: {
      label: "True Label",
      domain: labels,
      tickFormat: (d) => d,
    },
    color: {
      scheme: "Reds",
      label: "Average %",
    },
    marks: [
      Plot.cell(avgConfusionData, {
        x: "predicted_label",
        y: "true_label",
        fill: "percent",
        inset: 0.5,
        title: (d) =>
          `True: ${d.true_label}\nPredicted: ${d.predicted_label}\n${d.percent}%`,
      }),
      Plot.text(avgConfusionData, {
        x: "predicted_label",
        y: "true_label",
        text: (d) => `${d.percent}%`,
        fill: "white",
        textAnchor: "middle",
        fontSize: 12,
      }),
    ],
  });

  const rocPlot = Plot.plot({
    width: 500,
    height: 500,
    x: {
      label: "False Positive Rate",
      domain: [0, 1],
    },
    y: {
      label: "True Positive Rate",
      domain: [0, 1],
    },
    marks: [
      Plot.line(aggregatedROC, {
        x: "fpr",
        y: "tpr",
        stroke: "steelblue",
        strokeWidth: 2,
      }),
      Plot.areaY(aggregatedROC, {
        x: "fpr",
        y1: "ciLow",
        y2: "ciHigh",
        fill: "steelblue",
        fillOpacity: 0.3,
      }),
      Plot.ruleY([0, 1], {
        x: [0, 1],
        stroke: "gray",
        strokeDasharray: "2,2",
      }),
    ],
  });

  return {
    mlresults,
    metrics: { aucStats, avgConfusionData },
    plot: {
      confusionPlot: avgConfusionPlot,
      // rocPlot: rocPlot
    },
  };
}
return {trainMultiModel};
}});

define({id: "94502349", inputs: ["Inputs","html","Generators"], outputs: ["rfParamsForm","rfParamsForm_Selections"], body: (Inputs,html,Generators) => {
const rfParamsForm = Inputs.form({
  nEstimators: Inputs.range([1, 200], {
    value: 5,
    step: 1,
    label: html`<b>nEstimators</b>`,
    disabled: true,
  }),
  maxDepth: Inputs.range([1, 10], {
    value: 4,
    step: 1,
    label: html`<b>maxDepth</b>`,
    disabled: true,
  }),
  minSize: Inputs.range([1, 10], {
    value: 2,
    step: 1,
    label: html`<b>minSize</b>`,
    disabled: true,
  }),
  sampleSize: Inputs.range([0.1, 1.0], {
    value: 0.8,
    step: 0.1,
    label: html`<b>sampleSize</b>`,
    disabled: true,
  }),
  maxFeatures: Inputs.range([1, 10], {
    value: 3,
    step: 1,
    label: html`<b>maxFeatures</b>`,
    disabled: true,
  }),
  decimalPrecision: Inputs.range([1, 5], {
    value: 2,
    step: 1,
    label: html`<b>decimalPrecision</b>`,
    disabled: true,
  }),
});
// view(rfParamsForm)
const rfParamsForm_Selections = Generators.input(rfParamsForm);
return {rfParamsForm,rfParamsForm_Selections};
}});

define({id: "ea7fdca4", inputs: ["view","Inputs"], outputs: ["trainButton"], body: (view,Inputs) => {
// Create train button
const trainButton = view(Inputs.button("Train Model"));
// Training sequence generator
return {trainButton};
}});

define({id: "b3449c6c", inputs: ["trainButton","Generators","trainMultiModel","data","rfParamsForm_Selections"], outputs: ["modelResults"], body: (trainButton,Generators,trainMultiModel,data,rfParamsForm_Selections) => {
trainButton; // Run when button clicked
const modelResults = Generators.observe((next) => {
  if (trainButton) {
    next(trainMultiModel(data, rfParamsForm_Selections));
  } else {
    next("click to train");
  }
  return () => {};
}, trainButton);
return {modelResults};
}});

define({id: "c01743c0", inputs: ["view","modelResults"], body: (view,modelResults) => {
view(modelResults.plot.confusionPlot);
view(modelResults.plot.rocPlot);
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Measurement By Design</a></li>
  </ol>
  <div id="observablehq-search"><input type="search" placeholder="Search"></div>
  <div id="observablehq-search-results"></div>
  <script>{const o=document.querySelector("#observablehq-search");o.setAttribute("data-shortcut",`${/Mac|iPhone/.test(navigator.platform)?"\u2318":"Alt-"}K`);const t=o.querySelector("input"),r=()=>import("./_observablehq/search.8a05dc6f.js");t.addEventListener("focus",r,{once:!0}),t.addEventListener("keydown",r,{once:!0});const c=document.querySelector("#observablehq-sidebar-toggle");addEventListener("keydown",e=>{(e.code==="KeyK"&&e.metaKey&&!e.altKey&&!e.ctrlKey||e.key==="/"&&!e.metaKey&&!e.altKey&&!e.ctrlKey&&e.target===document.body)&&(c.checked?t.focus():(c.click(),t.focus(),c.click()),t.select(),e.preventDefault())});}</script>
  <ol>
    <li class="observablehq-link"><a href="./">Overview Dashboard</a></li>
  </ol>
  <details open>
    <summary>Imaging</summary>
    <ol>
    <li class="observablehq-link"><a href="./problem">Problem Definition</a></li>
    <li class="observablehq-link"><a href="./EDA-ROI">EDA &amp; ROI</a></li>
    <li class="observablehq-link"><a href="./hypothesis">Hypothesis</a></li>
    <li class="observablehq-link"><a href="./targeting">Targeting Strategy</a></li>
    <li class="observablehq-link"><a href="./exp-design">Experimental Design</a></li>
    <li class="observablehq-link"><a href="./personalization">Personalization</a></li>
    </ol>
  </details>
  <details open>
    <summary>Primitive Assets</summary>
    <ol>
    <li class="observablehq-link"><a href="./dpr-network">DPR Network Example</a></li>
    <li class="observablehq-link"><a href="./state-level-mapping">BRFSS State Level Mapping</a></li>
    <li class="observablehq-link"><a href="./exp-design-figures">Experimental Design Figures</a></li>
    <li class="observablehq-link"><a href="./live-table-data">Live Table</a></li>
    <li class="observablehq-link"><a href="./distp-demo">Distribution Demo</a></li>
    <li class="observablehq-link"><a href="./funnel-chart">Funnel Chart</a></li>
    <li class="observablehq-link"><a href="./intervention-design">Intervention Design</a></li>
    <li class="observablehq-link"><a href="./random-forest">In Browser Random Forests</a></li>
    <li class="observablehq-link"><a href="./mass-balance-business-models">Mass Balance Business Models</a></li>
    <li class="observablehq-link"><a href="./experimental-design">Simple Experimental Design</a></li>
    <li class="observablehq-link"><a href="./microsite">Microsite Demo</a></li>
    <li class="observablehq-link"><a href="./collapsible-cell">Collapsible Cell</a></li>
    </ol>
  </details>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#digging-deep-doing-the-right-eda">Digging deep: Doing the right EDA.</a></li>
<li class="observablehq-secondary-link"><a href="#hypothesis-and-recommended-actions">Hypothesis and Recommended Actions</a></li>
<li class="observablehq-secondary-link"><a href="#experimentation">Experimentation</a></li>
<li class="observablehq-secondary-link"><a href="#target-everyone-or-make-a-model">Target everyone or make a model</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<div class="observablehq observablehq--block"><!--:7a72c493:--></div>
<div class="observablehq observablehq--block"><!--:7381e00e:--></div>
<h1 id="unveiling-insights-in-imaging-utilization" tabindex="-1"><a class="observablehq-header-anchor" href="#unveiling-insights-in-imaging-utilization">Unveiling Insights in Imaging Utilization</a></h1>
<p>A picture may be worth a thousand words, but it may also cost several thousand dollars—especially when imaging is done at non-preferred facilities. On the surface, imaging utilization across the book appears stable. However, when we dig deeper, we uncover a hidden inefficiency: a significant fraction of members seem to be bypassing preferred facilities, leading to higher costs and missed opportunities for clinical alignment.</p>
<p>Non-preferred imaging usage might seem like a minor issue, but its cumulative impact is substantial. For specific clinical groups, such as those with chronic conditions like COPD, this problem is amplified. These members often require frequent imaging, and when they consistently visit non-preferred centers, the financial burden grows while coordination of care suffers.</p>
<p>This isn't just a cost problem; it's a care problem. By understanding who is driving this non-preferred utilization and why, we can uncover actionable insights to redirect behavior, reduce inefficiencies, and improve outcomes.</p>
<hr>
<h2 id="digging-deep-doing-the-right-eda" tabindex="-1"><a class="observablehq-header-anchor" href="#digging-deep-doing-the-right-eda">Digging deep: Doing <em>the right</em> EDA.</a></h2>
<div class="observablehq observablehq--block"><!--:32076022:--></div>
<p>Here's the dataset we've asked our data scientists to pull.</p>
<p>Dataset Description</p>
<ul>
<li>Total Book: <observablehq-loading></observablehq-loading><!--:cc43493b:--> individuals.</li>
<li><code>ID</code>: Unique identifier (string)</li>
<li><code>Age</code>: Integer (18-95)</li>
<li><code>Gender</code>: Categorical (Male, Female, Other)</li>
<li><code>Region</code>: Categorical (Urban, Rural, Suburban)</li>
<li><code>PlanType</code>: Categorical (Medicare Advantage, Medicare Supplement, Dual Eligible Special Needs Plan, Chronic Condition Special Needs Plan, Institutional Special Needs Plan, Employer Group Waiver Plan, Programs of All-Inclusive Care for the Elderly)</li>
<li><code>Diagnosis</code>: Categorical (COPD, Diabetes, Hypertension, None)</li>
<li><code>PrimaryCareEngagement</code>: Binary (Yes, No)</li>
<li><code>SmokingStatus</code>: Binary (Smoker, Non-Smoker)</li>
<li><code>IncomeBracket</code>: Categorical (Low, Medium, High)</li>
<li><code>ImagingVisits</code>: Count (integer)</li>
<li><code>Non_Preferred_Imaging_Visits</code>: Count (integer).</li>
</ul>
<h3 id="eda-step-1-create-fundamental-stats-on-the-data" tabindex="-1"><a class="observablehq-header-anchor" href="#eda-step-1-create-fundamental-stats-on-the-data"><strong>EDA STEP 1: Create fundamental stats on the data</strong></a></h3>
<figure>
<figcaption>
<strong> Table 1</strong>: Population Overview and Healthcare Patterns: This table summarizes key demographic attributes, health conditions, and utilization of healthcare services in an older population dataset.
</figcaption>
<div class="observablehq observablehq--block"><!--:2804730b:--></div>
</figure>
<div class="observablehq observablehq--block"><!--:3aa0b534:--></div>
<p><strong>Table 1</strong> provides a comprehensive overview of a dataset focused on an older population, with balanced demographics across gender, region, and income. Most individuals are engaged with primary care, though a significant portion is not, which could indicate opportunities for targeted interventions. Smoking status and diagnoses suggest a mix of health behaviors and conditions, with a notable proportion of undiagnosed individuals. Healthcare visits, particularly imaging, show a skewed distribution, hinting at variations in healthcare utilization that warrant further analysis.</p>
<hr>
<h3 id="eda-step-2-inspect-the-overall-distributions" tabindex="-1"><a class="observablehq-header-anchor" href="#eda-step-2-inspect-the-overall-distributions"><strong>EDA STEP 2: Inspect the Overall Distributions</strong></a></h3>
<p>Let's take this exploratory data analysis step by step, starting by inspecting the overall distribution of non-preferred imaging.</p>
<p>add: The average reported e.g., 22%.</p>
<figure>
<figcaption>
<strong> Figure 2</strong>: Non-preferred Imaging Overview: This figure shows the summarizes key demographic attributes, health conditions, and utilization of healthcare services in an older population dataset.
</figcaption>
<div class="observablehq observablehq--block"><!--:acbc38fb:--></div>
</figure>
<p><strong>Insight</strong>: Non-preferred imaging* visits make up <strong><observablehq-loading></observablehq-loading><!--:45aee45f:-->%</strong> of all imaging events.</p>
<p>Well. That seems <em>fairly</em> normal. Let's dive in a bit deeper by subsetting by plan type, region, whether or not they're engaged in primary care, smoking status, and income bracket.</p>
<hr>
<h3 id="eda-step-3-look-for-patterns-in-the-data" tabindex="-1"><a class="observablehq-header-anchor" href="#eda-step-3-look-for-patterns-in-the-data"><strong>EDA STEP 3: Look for patterns in the data</strong></a></h3>
<p>Let's take a look to see if we can make some basic cuts of the data and observe any patterns.</p>
<p><strong>Figure 3</strong> shows the percentage of non-preferred imaging visits for different health conditions (COPD, Diabetes, Hypertension, None) categorized by the dimension of choice (e.g., plan type, region, whether or not they're engaged in primary care, smoking status, and income bracket).</p>
<figure>
<figcaption>
<strong> Figure 3</strong>: Distribution of Visit Percentages by plan type, region, whether or not they're engaged in primary care, smoking status, and income bracket.
</figcaption>
<div class="observablehq observablehq--block"><!--:f2c14118:--></div>
<div class="observablehq observablehq--block"><!--:16b3a8c6:--></div>
</figure>
<p><strong>Insights</strong>:</p>
<ul>
<li>
<p>Across all plan types, income brackets, smoking status, members with COPD seem to be driving more non-preferred imaging utilization.</p>
<ul>
<li><strong><observablehq-loading></observablehq-loading><!--:9304763a:--></strong> members are diagnosed with COPD (<observablehq-loading></observablehq-loading><!--:92165dd9:--> of <observablehq-loading></observablehq-loading><!--:a8117185:-->).</li>
<li>Among these, <strong> <observablehq-loading></observablehq-loading><!--:01efc58f:--> </strong>  (<observablehq-loading></observablehq-loading><!--:c08287ae:--> unique members) visit non-preferred imaging centers.</li>
</ul>
</li>
<li>
<p>Rural members drive more non-preferred imaging utilization than suburban and Urban regions, with members with COPD driving ~3x more non-preferred imaging utilization than diabetes, hypertension, and those without a chronic condition.</p>
</li>
<li>
<p>Members without primary care engagement are ~2x as likely to drive non-preferred imaging utilization than those with a primary care physician.</p>
</li>
<li>
<p>Smoking status and income bracket do appear to be a significant factor in non-preferred imaging utilization.</p>
</li>
</ul>
<hr>
<h3 id="step-4-employ-a-hierarchical-grouping-to-explore-arbitrary-nested-levels-of-aggregation-across-key-parameters" tabindex="-1"><a class="observablehq-header-anchor" href="#step-4-employ-a-hierarchical-grouping-to-explore-arbitrary-nested-levels-of-aggregation-across-key-parameters"><strong>STEP 4: Employ a hierarchical grouping to explore arbitrary nested levels of aggregation across key parameters</strong></a></h3>
<div class="observablehq observablehq--block"><!--:9d079de2:--></div>
<div class="observablehq observablehq--block"><!--:624df75f:--></div>
<p>The picture is getting <em>clearer</em>. However, let's div a bit deeper still and create a hierarchical grouping to explore arbitrary nested levels of aggregation across key parameters. This systematic approach allows us to uncover patterns or trends that might not be apparent in flat groupings. For non-preferred imaging utilization, hierarchical grouping could shed light on factors influencing usage patterns at multiple levels of granularity.</p>
<p>The order you select the checkboxes will alter the hierarchical filtering.</p>
<div class="observablehq observablehq--block"><!--:c25a83a3:--></div>
<p>Your selection order: <observablehq-loading></observablehq-loading><!--:ec8b0fa2:--></p>
<div class="observablehq observablehq--block"><!--:753b8af0:--></div>
<div class="observablehq observablehq--block"><!--:f8ff7627:--></div>
<h2 id="hypothesis-and-recommended-actions" tabindex="-1"><a class="observablehq-header-anchor" href="#hypothesis-and-recommended-actions">Hypothesis and Recommended Actions</a></h2>
<h3 id="hypothesis" tabindex="-1"><a class="observablehq-header-anchor" href="#hypothesis">Hypothesis</a></h3>
<ol>
<li>
<p><strong>Clinical Opportunity</strong>:</p>
<ul>
<li>COPD patients aged 55+ are likely receiving imaging at non-preferred locations due to <strong>lower primary care engagement</strong> or limited local options.</li>
</ul>
</li>
<li>
<p><strong>Demographic Insight</strong>:</p>
<ul>
<li>Rural geography and low-income brackets amplify the problem, suggesting potential <strong>accessibility barriers</strong> or misinformation.</li>
</ul>
</li>
</ol>
<h3 id="recommended-actions" tabindex="-1"><a class="observablehq-header-anchor" href="#recommended-actions">Recommended Actions</a></h3>
<ol>
<li>Target COPD patients in rural areas with specific outreach to <strong>improve primary care engagement</strong>.</li>
<li>Launch campaigns in rural geographies to incentivize the use of preferred imaging centers (e.g., transport support, cost offsets).</li>
<li>Create educational materials for members 55+ on the benefits of preferred imaging.</li>
</ol>
<h2 id="experimentation" tabindex="-1"><a class="observablehq-header-anchor" href="#experimentation">Experimentation</a></h2>
<p>Now that we know where the opportunity lays, let's run an experiment to evaluate three design variations: a control (A), an alternative (AA), and an intervention (B). The goal is to measure user preference and identify the most effective design. To ensure valid results, the experiment must be properly sized, considering statistical power and expected effect sizes, to minimize risks of false positives or negatives.</p>
<p>After sizing and conducting the experiment, the results are summarized in the figure. The outcomes indicate the distribution of user preferences ("Preferred" vs. "Non-Preferred") for each design. This data provides actionable insights into how the designs perform relative to each other, guiding decision-making for future implementations.</p>
<figure>
<figcaption> <strong> Figure X</strong>: This figure illustrates the outcomes of an A/B/A test comparing the "control" (A), an alternative design (AA), and an intervention design (B). The figure shows the distribution of participants between "Preferred" and "Non-Preferred" outcomes for each design, along with their respective percentages. Key observations include:
</figcaption>
<div class="observablehq observablehq--block"><!--:649c196a:--></div>
<div class="observablehq observablehq--block"><!--:d8abab8c:--></div>
</figure>
<h2 id="target-everyone-or-make-a-model" tabindex="-1"><a class="observablehq-header-anchor" href="#target-everyone-or-make-a-model">Target everyone or make a model</a></h2>
<div class="observablehq observablehq--block"><!--:09d94069:--></div>
<div class="observablehq observablehq--block"><!--:a40fbdc5:--></div>
<div class="observablehq observablehq--block"><!--:94502349:--></div>
<div class="observablehq observablehq--block"><!--:ea7fdca4:--></div>
<div class="observablehq observablehq--block"><!--:b3449c6c:--></div>
<div class="observablehq observablehq--block"><!--:c01743c0:--></div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-12-08T22:23:45">Dec 8, 2024</a>.</div>
</footer>
</div>
</body>
</html>
