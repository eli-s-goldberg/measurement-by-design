<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.0">
<title>Cluster Randomized Designs | Measurement By Design</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air.aad62322.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="preload" as="style" href="./_npm/katex@0.16.11/dist/katex.min.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air.aad62322.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="./_npm/katex@0.16.11/dist/katex.min.css">
<link rel="modulepreload" href="./_observablehq/client.11aa6b6e.js">
<link rel="modulepreload" href="./_observablehq/runtime.9393ab6d.js">
<link rel="modulepreload" href="./_observablehq/stdlib.95bfbf7e.js">
<link rel="modulepreload" href="./_import/components/parallelmethods.b03db0aa.js">
<link rel="modulepreload" href="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js">
<link rel="modulepreload" href="./_node/d3-require@1.3.0/index.45152b81.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.d397b6a8.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/e828d8c8.js">
<link rel="modulepreload" href="./_observablehq/stdlib/tex.c8bffae1.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/063eb405.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/katex@0.16.11/c006fecc.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/7055d4c5.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/a62ae5ce.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/d44feff9.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/5830b12a.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/84d7b8e9.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/626bedc4.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/b22c5864.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/6f15f633.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/ef1ec490.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/bbafde58.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/32c7fec2.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/cf9b720b.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/5dcd62f4.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/8debb4ba.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/4b0cc581.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/1ee6c50d.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<script type="module">

import {define} from "./_observablehq/client.11aa6b6e.js";

define({id: "59b5fcea", outputs: ["calculateSampleSizeForMeans","calculateSampleSizeForProportions","calculateVarianceFormulaIndividualRandomized","calculateVarianceFormulaClusterRandomized","generateVarianceData","generateUnifiedVarianceData"], body: async () => {
const {calculateSampleSizeForMeans, calculateSampleSizeForProportions, calculateVarianceFormulaIndividualRandomized, calculateVarianceFormulaClusterRandomized, generateVarianceData, generateUnifiedVarianceData} = await import("./_import/components/parallelmethods.b03db0aa.js");

return {calculateSampleSizeForMeans,calculateSampleSizeForProportions,calculateVarianceFormulaIndividualRandomized,calculateVarianceFormulaClusterRandomized,generateVarianceData,generateUnifiedVarianceData};
}});

define({id: "18a325c3", outputs: ["d3","numeric","require","jStat"], body: async () => {
const [d3, numeric, {require}] = await Promise.all([import("https://cdn.jsdelivr.net/npm/d3@7/+esm"), import("https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"), import("./_node/d3-require@1.3.0/index.45152b81.js")]);
const jStat = await require("jstat@1.9.4")
return {d3,numeric,require,jStat};
}});

define({id: "608bb43c", inputs: ["tex"], outputs: ["equation_3","equation_4"], body: (tex) => {
const equation_3 = tex.block`\begin{equation} \text{Var}(\overline{Y}) = \frac{\sigma^2}{n} \end{equation}`
const equation_4 = tex.block`\begin{equation} \text{Var}(\overline{Y}) = \frac{\sigma^2}{k \cdot m} \left[ 1 + (m - 1) \cdot \rho \right] \end{equation}`
return {equation_3,equation_4};
}});

define({id: "74486fa9", inputs: ["view","equation_3"], body: (view,equation_3) => {
view(equation_3)
}});

define({id: "691ff5e5", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\sigma^2`
))
}});

define({id: "092e3ae4", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`n`
))
}});

define({id: "ffd9b282", inputs: ["view","equation_4"], body: (view,equation_4) => {
view(equation_4)
}});

define({id: "691ff5e5-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\sigma^2`
))
}});

define({id: "7fac2155", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`m`
))
}});

define({id: "815f512a", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\rho`
))
}});

define({id: "cf546aab", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`K`
))
}});

define({id: "83c41166", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\left[ 1 + (m - 1) \rho \right]`
))
}});

define({id: "8580bd89", inputs: ["Inputs","tex","view"], outputs: ["sigma_var","n_var","k_var","m_var","rho_var"], body: (Inputs,tex,view) => {
const sigma_var = Inputs.range([0, 10], {
  value: 0.1,
  step: 0.1,
  label: tex`\text{standard dev.}:~\sigma`,
})
view(sigma_var)

const n_var = Inputs.range([0, 1000], {
  value: 30,
  step: 0.1,
  label: tex`\text{num subjects}:~n`,
})
view(n_var)

const k_var = Inputs.range([0, 10], {
  value: 3,
  step: 1,
  label: tex`\text{num of clusters}:~k`,
})
view(k_var)

const m_var = Inputs.range([0, 10], {
  value: 5,
  step: 1,
  label: tex`\text{subj. per cluster}:~m`,
})
view(m_var)

const rho_var = Inputs.range([0, 1], {
  value: 0.1,
  step: 0.05,
  label: tex`\text{ICC}:~\rho`,
})
view(rho_var)
return {sigma_var,n_var,k_var,m_var,rho_var};
}});

define({id: "7ff07e47", inputs: ["Generators","sigma_var","n_var","k_var","m_var","rho_var"], outputs: ["sigma_var_selection","n_var_selection","k_var_selection","m_var_selection","rho_var_selection"], body: (Generators,sigma_var,n_var,k_var,m_var,rho_var) => {
const sigma_var_selection = Generators.input(sigma_var)
const n_var_selection = Generators.input(n_var)
const k_var_selection = Generators.input(k_var)
const m_var_selection = Generators.input(m_var)
const rho_var_selection = Generators.input(rho_var)
return {sigma_var_selection,n_var_selection,k_var_selection,m_var_selection,rho_var_selection};
}});

define({id: "e8f4c107", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`n=k \cdot m`
))
}});

define({id: "14731080", inputs: ["calculateVarianceFormulaIndividualRandomized","sigma_var_selection","n_var_selection","calculateVarianceFormulaClusterRandomized","k_var_selection","m_var_selection","rho_var_selection"], outputs: ["variance1","variance2"], body: (calculateVarianceFormulaIndividualRandomized,sigma_var_selection,n_var_selection,calculateVarianceFormulaClusterRandomized,k_var_selection,m_var_selection,rho_var_selection) => {
const variance1 = calculateVarianceFormulaIndividualRandomized(
  sigma_var_selection,
  n_var_selection
)
const variance2 = calculateVarianceFormulaClusterRandomized(
  sigma_var_selection,
  k_var_selection,
  m_var_selection,
  rho_var_selection
)
return {variance1,variance2};
}});

define({id: "2718efb5", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\text{Var}_\text{Individual}=` 
))
}});

define({id: "490e9731", mode: "inline", inputs: ["variance1","display"], body: async (variance1,display) => {
display(await(
variance1.toFixed(3)
))
}});

define({id: "1166f951", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\text{Var}_\text{cluster}=` 
))
}});

define({id: "25bacbbc", mode: "inline", inputs: ["variance2","display"], body: async (variance2,display) => {
display(await(
variance2.toFixed(3)
))
}});

define({id: "c5745454", inputs: ["tex","d3","Inputs","view","Generators"], outputs: ["variables","favorite","favorite_selection"], body: (tex,d3,Inputs,view,Generators) => {
const variables = [
  { name: tex`n`, variable: "n", range: d3.range(1, 100, 0.1) },
  { name: tex`k`, variable: "k", range: d3.range(1, 10, 0.1) },
  { name: tex`m`, variable: "m", range: d3.range(1, 20, 0.1) },
  { name: tex`\rho`, variable: "rho", range: d3.range(0, 1.1, 0.1) },
]
const favorite = Inputs.radio(variables, {
  label: "Pick a variable",
  format: (x) => x.name,
  value: variables[2],
})
view(favorite)
const favorite_selection = Generators.input(favorite)
return {variables,favorite,favorite_selection};
}});

define({id: "172cb070", inputs: ["generateUnifiedVarianceData","favorite_selection","sigma_var_selection","k_var_selection","m_var_selection","rho_var_selection","n_var_selection"], outputs: ["unifiedData"], body: (generateUnifiedVarianceData,favorite_selection,sigma_var_selection,k_var_selection,m_var_selection,rho_var_selection,n_var_selection) => {
// Generate data
const unifiedData = generateUnifiedVarianceData(
  favorite_selection.variable,
  favorite_selection.range,
  sigma_var_selection,
  k_var_selection,
  m_var_selection,
  rho_var_selection,
  n_var_selection
)
return {unifiedData};
}});

define({id: "c6831c06", inputs: ["Plot","favorite_selection","unifiedData","view"], outputs: ["variance_comparison"], body: (Plot,favorite_selection,unifiedData,view) => {
const variance_comparison = Plot.plot({
  grid: true,
  marginLeft: 80,
  x: { label: favorite_selection.variable },
  y: { label: "Variance" },
  color: {
    legend: true,
    domain: ["Individual Variance", "Cluster Variance", "Variance Delta"],
  },
  marks: [
    Plot.line(unifiedData, {
      x: "x",
      y: "variance",
      stroke: "variance_type",
    }),
    Plot.frame(),
    Plot.gridY({
      strokeDasharray: "0.75,2", // dashed
      strokeOpacity: 1, // opaque
    }),
    Plot.axisY([0]),
  ],
})
view(variance_comparison)
return {variance_comparison};
}});

define({id: "815f512a-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\rho`
))
}});

define({id: "a56d80cc", inputs: ["tex","view"], outputs: ["equation_icc"], body: (tex,view) => {
const equation_icc = tex.block`\begin{equation} 
\rho = \frac{\sigma_b^2}{\sigma_b^2 + \sigma_w^2} 
\end{equation}`

view(equation_icc)
return {equation_icc};
}});

define({id: "fa9abff5", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\sigma_b^2`
))
}});

define({id: "fa9abff5-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\sigma_b^2`
))
}});

define({id: "b6f5160f", inputs: ["tex","view"], outputs: ["equation_variance"], body: (tex,view) => {
const equation_variance = tex.block`\begin{equation} 
\sigma^2 = \sigma_b^2 + \sigma_w^2 
\end{equation}`
view(equation_variance)
return {equation_variance};
}});

define({id: "6a2e0559", inputs: ["tex","view"], outputs: ["equation_sample_size"], body: (tex,view) => {
const equation_sample_size = tex.block`\begin{equation} 
km = \left[ 1 + (m - 1) \rho \right] \frac{(z_{1-\alpha/2} + z_{\beta})^2 2 \sigma^2}{(\mu_1 - \mu_2)^2}
\end{equation}`
view(equation_sample_size)
return {equation_sample_size};
}});

define({id: "24fdd8b6", inputs: ["tex","view"], outputs: ["equation_km"], body: (tex,view) => {
const equation_km = tex.block`\begin{equation} 
k\cdot m = \left[ 1 + (m - 1) \rho \right]\cdot n
\end{equation}`
view(equation_km)
return {equation_km};
}});

define({id: "7fac2155-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`m`
))
}});

define({id: "643c39c0", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`k`
))
}});

define({id: "1b2a05d2", inputs: ["tex","view"], outputs: ["equation_k"], body: (tex,view) => {
const equation_k = tex.block`\begin{equation} 
k = \frac{\left[ 1 + (m - 1) \rho \right] n}{m}
\end{equation}`

view(equation_k)
return {equation_k};
}});

define({id: "092e3ae4-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`n`
))
}});

define({id: "092e3ae4-2", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`n`
))
}});

define({id: "c691d519", mode: "inline", inputs: ["view","n_proportions"], body: (view,n_proportions) => {
view(n_proportions)
}});

define({id: "7066cadf", inputs: ["view","z_alpha_2_proportions","z_beta_proportions","p1_proportions","p2_proportions"], body: (view,z_alpha_2_proportions,z_beta_proportions,p1_proportions,p2_proportions) => {
view(z_alpha_2_proportions)
view(z_beta_proportions)
view(p1_proportions)
view(p2_proportions)
}});

define({id: "32debcc8", mode: "inline", inputs: ["des_eff","display"], body: async (des_eff,display) => {
display(await(
des_eff.toFixed(3)
))
}});

define({id: "dfa022ea", mode: "inline", inputs: ["total_subjects","des_eff","n_proportions","display"], body: async (total_subjects,des_eff,n_proportions,display) => {
display(await(
total_subjects(des_eff,n_proportions).toFixed(3)
))
}});

define({id: "6374b712", inputs: ["view","Inputs","tex"], outputs: ["m_var_size","rho_var_size"], body: (view,Inputs,tex) => {
const m_var_size = view(
  Inputs.range([0, 300], {
    value: 5,
    step: 1,
    label: tex`\text{subj. per cluster}:~m`,
  })
)

const rho_var_size = view(
  Inputs.range([0, 1], {
    value: 0.1,
    step: 0.05,
    label: tex`\text{ICC}:~\rho`,
  })
)
return {m_var_size,rho_var_size};
}});

define({id: "f4bc311b", outputs: ["design_effect","total_subjects","clusters_per_arm"], body: () => {
function design_effect(rho, m) {
  return 1 + (m - 1) * rho
}

function total_subjects(de, n) {
  return de * n
}

function clusters_per_arm(total_subj, m) {
  return total_subj / m
}
return {design_effect,total_subjects,clusters_per_arm};
}});

define({id: "4920aa9b", inputs: ["design_effect","rho_var_size","m_var_size"], outputs: ["des_eff"], body: (design_effect,rho_var_size,m_var_size) => {
const des_eff = design_effect(rho_var_size, m_var_size)
return {des_eff};
}});

define({id: "01ba4719", body: () => {

}});

define({id: "7fac2155-2", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`m`
))
}});

define({id: "643c39c0-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`k`
))
}});

define({id: "338248ff", mode: "inline", inputs: ["clusters_per_arm","total_subjects","des_eff","n_proportions","m_var_size","display"], body: async (clusters_per_arm,total_subjects,des_eff,n_proportions,m_var_size,display) => {
display(await(
clusters_per_arm(total_subjects(des_eff,n_proportions), m_var_size).toFixed(3)
))
}});

define({id: "04934017", inputs: ["Inputs","tex","Generators"], outputs: ["z_alpha_2_proportions","z_beta_proportions","sigma_proportions","p1_proportions","p2_proportions","z_alpha_2_proportions_selection","z_beta_proportions_selection","p1_proportions_selection","p2_proportions_selection"], body: (Inputs,tex,Generators) => {
const z_alpha_2_proportions = Inputs.range([0, 5], {
  value: 1.96,
  step: 0.01,
  label: tex`Z_{1-\alpha/2}`,
})
const z_beta_proportions = Inputs.range([0, 5], {
  value: 0.84,
  step: 0.01,
  label: tex`Z_\beta`,
})
const sigma_proportions = Inputs.range([0, 10], {
  value: 30,
  step: 0.01,
  label: tex`\sigma`,
})
const p1_proportions = Inputs.range([0, 1], {
  value: 0.5,
  step: 0.01,
  label: tex`p_1`,
})
const p2_proportions = Inputs.range([0, 1], {
  value: 0.55,
  step: 0.01,
  label: tex`p_2`,
})

const z_alpha_2_proportions_selection = Generators.input(z_alpha_2_proportions)
const z_beta_proportions_selection = Generators.input(z_beta_proportions)

const p1_proportions_selection = Generators.input(p1_proportions)
const p2_proportions_selection = Generators.input(p2_proportions)
return {z_alpha_2_proportions,z_beta_proportions,sigma_proportions,p1_proportions,p2_proportions,z_alpha_2_proportions_selection,z_beta_proportions_selection,p1_proportions_selection,p2_proportions_selection};
}});

define({id: "80bb1516", inputs: ["calculateSampleSizeForProportions","z_alpha_2_proportions_selection","z_beta_proportions_selection","p1_proportions_selection","p2_proportions_selection"], outputs: ["n_proportions"], body: (calculateSampleSizeForProportions,z_alpha_2_proportions_selection,z_beta_proportions_selection,p1_proportions_selection,p2_proportions_selection) => {
const n_proportions = calculateSampleSizeForProportions(
  z_alpha_2_proportions_selection,
  z_beta_proportions_selection,
  p1_proportions_selection,
  p2_proportions_selection
)
return {n_proportions};
}});

define({id: "643c39c0-2", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`k`
))
}});

define({id: "55f0f5df", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\le`
))
}});

define({id: "815f512a-2", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\rho`
))
}});

define({id: "65626f6c", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`2k-2`
))
}});

define({id: "3a91ff80", inputs: ["tex"], outputs: ["equation_ccv"], body: (tex) => {
const equation_ccv = tex.block`\begin{equation} 
\text{CCV} = \frac{\sigma_b^2}{\mu} 
\end{equation}`
return {equation_ccv};
}});

define({id: "598b833e", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\mu`
))
}});

define({id: "2e2cf06c", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`\sigma_{b}^2`
))
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Measurement By Design</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./">Overview Dashboard</a></li>
  </ol>
  <details open>
    <summary>Imaging</summary>
    <ol>
    <li class="observablehq-link"><a href="./value-framing">Problem Definition</a></li>
    <li class="observablehq-link"><a href="./EDA-ROI">EDA &amp; ROI</a></li>
    <li class="observablehq-link"><a href="./hypothesis">Hypothesis</a></li>
    <li class="observablehq-link"><a href="./targeting">Targeting Strategy</a></li>
    <li class="observablehq-link"><a href="./exp-design">Experimental Design</a></li>
    </ol>
  </details>
  <details open>
    <summary>Primitive Assets</summary>
    <ol>
    <li class="observablehq-link"><a href="./state-level-mapping">BRFSS State Level Mapping</a></li>
    <li class="observablehq-link"><a href="./exp-design-figures">Experimental Design Figures</a></li>
    <li class="observablehq-link"><a href="./live-table-data">Live Table</a></li>
    <li class="observablehq-link"><a href="./distp-demo">Distribution Demo</a></li>
    <li class="observablehq-link"><a href="./funnel-chart">Funnel Chart</a></li>
    <li class="observablehq-link"><a href="./intervention-design">Intervention Design</a></li>
    <li class="observablehq-link"><a href="./random-forest">In Browser Random Forests</a></li>
    <li class="observablehq-link"><a href="./mass-balance-business-models">Mass Balance Business Models</a></li>
    <li class="observablehq-link"><a href="./experimental-design">Simple Experimental Design</a></li>
    <li class="observablehq-link"><a href="./microsite">Microsite Demo</a></li>
    <li class="observablehq-link"><a href="./collapsible-cell">Collapsible Cell</a></li>
    </ol>
  </details>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#cluster-randomized">Cluster Randomized</a></li>
<li class="observablehq-secondary-link"><a href="#quantifying-the-effect-of-clustering">Quantifying the effect of clustering</a></li>
<li class="observablehq-secondary-link"><a href="#how-do-you-estimate-the-icc">How do you estimate the ICC?</a></li>
<li class="observablehq-secondary-link"><a href="#caveats-for-rcts-with-a-small-number-of-clusters">Caveats for RCTs with a small number of clusters</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<div class="observablehq observablehq--block"><!--:59b5fcea:--></div>
<div class="observablehq observablehq--block"><!--:18a325c3:--></div>
<style>
      body {
      font: 13.5px/1.5 var(--serif);
      margin: 0;
      max-width: 90%;
      }

      table {
          border-collapse: collapse;
          table-layout:fixed;
          width: 100%;
          height: 20%;
          font: 13.5px/1.5 var(--serif);

      }
      th {
          font: 13.5px/1.5 var(--serif);
          font-weight: bold;
          border-top: 1px solid black;
          border-bottom: 1px solid black;
    }
    tr:last-child td {
        /* font-weight: bold; */
        border-bottom: 1px solid black;
        /* background-color: lightyellow; */
    }
    /* tr:nth-last-child(2) {
        border-bottom: 1px dashed black;
    } */
    td, th {
        text-align: left;
        border-collapse: collapse;
        padding:2px;
        font-size:0.8em;
    }

    .horizontal-line {
    border-top: 0.5px solid #d3d3d3; /* Creates a thin gray line */
    width: 100%; /* Spans the width of the container/page */
    margin-top:10px;
    margin-bottom:10px
    }

    .katex { font-size: 1em; }

      p { max-width: 90% }


</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.2/math.min.js"> </script>
<h1 id="cluster-random-designs" tabindex="-1"><a class="observablehq-header-anchor" href="#cluster-random-designs">Cluster Random Designs</a></h1>
<p>Derived from this video <a href="https://www.youtube.com/watch?v=JOtwZyaJZpk" target="_blank" rel="noopener noreferrer">S4b Sample size and power for cluster randomised trial</a></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/JOtwZyaJZpk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
<p>I <em>love</em> the way that Dr. Karla Hemming goes through these, so I thought I would follow-along and codify here work for fun!</p>
<div class="horizontal-line"></div>
<h1 id="cluster-randomized" tabindex="-1"><a class="observablehq-header-anchor" href="#cluster-randomized">Cluster Randomized</a></h1>
<p><strong>Question:</strong> why do the formula's change when using a cluster randomized trial (CRT) design from this:</p>
<div class="observablehq observablehq--block"><!--:608bb43c:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:74486fa9:--></div>
<p>Where <observablehq-loading></observablehq-loading><!--:691ff5e5:-->is the variance of the outcome variable, and <observablehq-loading></observablehq-loading><!--:092e3ae4:-->: is the total number of individuals.</p>
<p>To this?</p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:ffd9b282:--></div>
<p>Where <observablehq-loading></observablehq-loading><!--:691ff5e5-1:--> is the variance of the outcome variable, <observablehq-loading></observablehq-loading><!--:7fac2155:--> is the average cluster size (number of individuals per cluster), <observablehq-loading></observablehq-loading><!--:815f512a:--> is the intracluster correlation coefficient (ICC), and <observablehq-loading></observablehq-loading><!--:cf546aab:--> is the total number of clusters per arm.</p>
<p><strong>Answer:</strong> Subjects within the same cluster may be more similar to each other than to subjects in other clusters. This correlation leads to an increase in the variance compared to simple random sampling.</p>
<p>This: <observablehq-loading></observablehq-loading><!--:83c41166:--> is known as the <strong>inflation effect</strong> or <strong>design effect</strong></p>
<p>What is the difference? Does this matter?</p>
<div class="observablehq observablehq--block"><!--:8580bd89:--></div>
<div class="observablehq observablehq--block"><!--:7ff07e47:--></div>
<p>For equivalence, set <observablehq-loading></observablehq-loading><!--:e8f4c107:--></p>
<div class="observablehq observablehq--block"><!--:14731080:--></div>
<p>^ ICC: intra-cluster correlation coefficient.
<observablehq-loading></observablehq-loading><!--:2718efb5:--> <observablehq-loading></observablehq-loading><!--:490e9731:-->
<observablehq-loading></observablehq-loading><!--:1166f951:--> <observablehq-loading></observablehq-loading><!--:25bacbbc:--></p>
<div class="observablehq observablehq--block"><!--:c5745454:--></div>
<div class="observablehq observablehq--block"><!--:172cb070:--></div>
<div class="observablehq observablehq--block"><!--:c6831c06:--></div>
<h2 id="quantifying-the-effect-of-clustering" tabindex="-1"><a class="observablehq-header-anchor" href="#quantifying-the-effect-of-clustering">Quantifying the effect of clustering</a></h2>
<p>The ICC, or <observablehq-loading></observablehq-loading><!--:815f512a-1:--> quantifies the effect of clustering. It's a quantity between 0--1.</p>
<div class="observablehq observablehq--block"><!--:a56d80cc:--></div>
<p>Where <observablehq-loading></observablehq-loading><!--:fa9abff5:--> is the <em>between</em> cluster variance and <observablehq-loading></observablehq-loading><!--:fa9abff5-1:--> is the <em>within</em> cluster variance.</p>
<p>The total variance is equal to the sum of the between and within cluster variance:</p>
<div class="observablehq observablehq--block"><!--:b6f5160f:--></div>
<p>So when we're trying to determine the sample size in a cluster randomized trial, the required number of subjects in each arm is inflated by the design effect.</p>
<div class="observablehq observablehq--block"><!--:6a2e0559:--></div>
<p>Becomes:</p>
<div class="observablehq observablehq--block"><!--:24fdd8b6:--></div>
<p>Where we then divide by <observablehq-loading></observablehq-loading><!--:7fac2155-1:--> to get the number of clusters per arm, <observablehq-loading></observablehq-loading><!--:643c39c0:--> for a CRT testing two proportions.</p>
<div class="observablehq observablehq--block"><!--:1b2a05d2:--></div>
<div class="note" label="Example: 4 steps to size a cluster randomized trial, with a lot of caveats">
<p>For the case of a binary outcome for superiority, let's walk through the 3 steps needed to size this study.</p>
<ol>
<li>Calculate <observablehq-loading></observablehq-loading><!--:092e3ae4-1:--> needed in non-randomized design. In this case, a CRT testing two proportions. Observations needed per arm, <b> <observablehq-loading></observablehq-loading><!--:092e3ae4-2:--> = <observablehq-loading></observablehq-loading><!--:c691d519:--></b></li>
</ol>
<div class="observablehq observablehq--block"><!--:7066cadf:--></div>
<ol start="2">
<li>Inflate by the design effect, <b><observablehq-loading></observablehq-loading><!--:32debcc8:--> </b>. Total number of subjects needed, <b> <observablehq-loading></observablehq-loading><!--:dfa022ea:--></b>.</li>
</ol>
<div class="observablehq observablehq--block"><!--:6374b712:--></div>
<div class="observablehq observablehq--block"><!--:f4bc311b:--></div>
<div class="observablehq observablehq--block"><!--:4920aa9b:--></div>
<div class="observablehq observablehq--block"><!--:01ba4719:--></div>
<ol start="3">
<li>Estimate number of clusters needed by didviding by <observablehq-loading></observablehq-loading><!--:7fac2155-2:-->: <b><observablehq-loading></observablehq-loading><!--:643c39c0-1:--> = <observablehq-loading></observablehq-loading><!--:338248ff:--></b>.</li>
</ol>
<div class="observablehq observablehq--block"><!--:04934017:--></div>
<div class="observablehq observablehq--block"><!--:80bb1516:--></div>
<ol start="4">
<li>If <observablehq-loading></observablehq-loading><!--:643c39c0-2:--> is <observablehq-loading></observablehq-loading><!--:55f0f5df:--> 10--15, add an addition cluster per arm.</li>
</ol>
</div>
<h2 id="how-do-you-estimate-the-icc" tabindex="-1"><a class="observablehq-header-anchor" href="#how-do-you-estimate-the-icc">How do you estimate the ICC?</a></h2>
<p>The ICC <observablehq-loading></observablehq-loading><!--:815f512a-2:--> is assumed or estimated. When historical data is available, you can obtain an estimate by fitting a mixed model to the data. However, the uncertainty associated with any estimated correlations (particular for small n studies) may be large, rendering these estimates to be more or less uninformative.</p>
<p>When the endpoints are binary, the ICC's put into these calculations need to be put in the proportion scale. (fitted by linear mixed models, not logistic models, to estimate the ICC's).</p>
<p>When there's no information, not all is lost. However, as the ICC is a measure of correlation within the same cluster, it really only make sense to use an ICC value from other similar trials or studies will be appropriate when:</p>
<ol>
<li>Same (similar) outcome - Outcome type (ICCs for process outcomes higher than for clinical outcomes)</li>
<li>Same (similar) cluster size - Cluster size (ICCs from smaller clusters tend to be higher)</li>
<li>Same (similar) setting - Setting (ICCs in secondary care are typically higher than ICCs in primary care)</li>
<li>Same (similar) prevalence - Prevalence (ICCs from more prevalent outcomes tend to be higher)</li>
</ol>
<p>Further, in the absence of specific information on likely ICCs, recommendations are to use patterns observed from empirical studies of correlations.</p>
<h2 id="caveats-for-rcts-with-a-small-number-of-clusters" tabindex="-1"><a class="observablehq-header-anchor" href="#caveats-for-rcts-with-a-small-number-of-clusters">Caveats for RCTs with a small number of clusters</a></h2>
<p>These formulas are generally derived/applied to large cluster studies.</p>
<ol>
<li>For parallel arm analysis, use critical values from the t-distribution, rather than the normal (z) distribution</li>
<li>Set the number of degrees of freedom to: <observablehq-loading></observablehq-loading><!--:65626f6c:--></li>
<li>If needed at the sample-size design stage, add one cluster per arm (or two, if you're feeling extra conservative).</li>
</ol>
<div class="note">
<p>Qunatifying the ICC is typically done by measuring the degree of clustering. However, an alternative is to use the Coefficient of Cluster Variation (CCV):</p>
<div class="observablehq observablehq--block"><!--:3a91ff80:--></div>
<p>where <observablehq-loading></observablehq-loading><!--:598b833e:--> is the true (unknown) cluster mean, proportion, or rate; and <observablehq-loading></observablehq-loading><!--:2e2cf06c:--> is the between-cluster variance.</p>
<p>This can be a useful metric when only cluster-level means are available from any data being used to estimate correlations, or when the outcome is a count or rate rather than a continuous or binary outcome (e.g., gap closure).</p>
</div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-12-05T02:19:43">Dec 5, 2024</a>.</div>
</footer>
</div>
</body>
</html>
