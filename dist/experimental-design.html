<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Choosing an experimental design | Data Matters</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_import/components/swmethods.e6391363.js">
<link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/d3@7/+esm">
<link rel="modulepreload" href="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js">
<link rel="modulepreload" href="./_node/d3-require@1.3.0/index.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.15/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/experimental-flare.json", {"name":"./data/experimental-flare.json","mimeType":"application/json","path":"./_file/data/experimental-flare.7d77350a.json","lastModified":1718233367913});

define({id: "ba0d0f1d", outputs: ["calculateSampleSizeWithDesignMatrix","calculateFollowUpPeriods","calculateStandardizedMeanDifference","DesignMatrix","DesignMatrixWithDetails","vartheta_Krep","vartheta_m","assignClustersToDesignMatrix","d3","numeric","require","jStat"], body: async () => {
const [{calculateSampleSizeWithDesignMatrix, calculateFollowUpPeriods, calculateStandardizedMeanDifference, DesignMatrix, DesignMatrixWithDetails, vartheta_Krep, vartheta_m, assignClustersToDesignMatrix}, d3, numeric, {require}] = await Promise.all([import("./_import/components/swmethods.e6391363.js"), import("https://cdn.jsdelivr.net/npm/d3@7/+esm"), import("https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"), import("./_node/d3-require@1.3.0/index.js")]);
const jStat = await require("jstat@1.9.4")
return {calculateSampleSizeWithDesignMatrix,calculateFollowUpPeriods,calculateStandardizedMeanDifference,DesignMatrix,DesignMatrixWithDetails,vartheta_Krep,vartheta_m,assignClustersToDesignMatrix,d3,numeric,require,jStat};
}});

define({id: "1d46b041", inputs: ["Plot","flare_flat","indent","view"], outputs: ["result_cluster"], body: (Plot,flare_flat,indent,view) => {
const result_cluster = Plot.plot({
  axis: null,
  inset: 10,
  marginLeft: 60,
  marginRight: 60,
  round: true,
  // width: 1000,
  // height: 800,
  marks: Plot.cluster(flare_flat, {
    // treeSort: "node:height",
    textStroke: "white",
    treeLayout: indent,
    delimiter: "/",
    // curve: "step-before",
  }),
})

view(result_cluster)
return {result_cluster};
}});

define({id: "2009b73c", inputs: ["FileAttachment"], outputs: ["design_json"], body: (FileAttachment) => {
const design_json = FileAttachment("./data/experimental-flare.json").json()
return {design_json};
}});

define({id: "a365d15f", inputs: ["design_json"], outputs: ["flattenHierarchy","flare_flat"], body: (design_json) => {
function flattenHierarchy(node, path = []) {
  if (!node.children || node.children.length === 0) {
    return [path.concat(node.name).join("/")]
  }

  return node.children.flatMap((child) =>
    flattenHierarchy(child, path.concat(node.name))
  )
}
const flare_flat = flattenHierarchy(design_json)
return {flattenHierarchy,flare_flat};
}});

define({id: "413fe614", outputs: ["indent"], body: () => {
function indent() {
  return (root) => {
    root.eachBefore((node, i) => {
      node.y = node.depth
      node.x = i
    })
  }
}
return {indent};
}});

define({id: "c934b0e6", inputs: ["Inputs","Generators","view"], outputs: ["trialDesign","trialDesignSelection"], body: (Inputs,Generators,view) => {
const trialDesign = Inputs.radio(
  new Map([
    ["Parallel", "Parallel"],
    ["Parallel with baseline measure", "Before and After"],
    ["Two-period cross-over", "Cross-over"],
    ["Stepped-wedge", "Stepped-wedge"],
    ["Multiple-period cross-over", "Multi cross-over"],
  ]),
  { value: "Parallel", label: "Trial Design" }
)
const trialDesignSelection = Generators.input(trialDesign)
view(trialDesign)
return {trialDesign,trialDesignSelection};
}});

define({id: "d3fccb9f", inputs: ["Inputs","Generators","view"], outputs: ["periods","periodsSelection"], body: (Inputs,Generators,view) => {
const periods = Inputs.range([2, 10], {
  value: 4,
  step: 1,
  label: "Experimental Periods",
})
const periodsSelection = Generators.input(periods)
view(periods)
return {periods,periodsSelection};
}});

define({id: "bcf9577d", inputs: ["DesignMatrix","trialDesignSelection","periodsSelection"], outputs: ["dm"], body: (DesignMatrix,trialDesignSelection,periodsSelection) => {
const dm = DesignMatrix(trialDesignSelection, periodsSelection)
return {dm};
}});

define({id: "d56edcea", inputs: ["dm"], outputs: ["flattenedDm"], body: (dm) => {
const flattenedDm = dm.flatMap((row, i) =>
  row.map((cell, j) => ({ x: j, y: i, value: cell }))
)
return {flattenedDm};
}});

define({id: "7709298f", inputs: ["Plot","flattenedDm"], outputs: ["designMatrixPlot"], body: (Plot,flattenedDm) => {
const designMatrixPlot = Plot.plot({
  marks: [
    Plot.cell(flattenedDm, {
      x: "x",
      y: "y",
      fill: (d) => (d.value === 1 ? "green" : "white"),
    }),
    Plot.text(flattenedDm, {
      x: "x",
      y: "y",
      text: (d) => d.value,
      fill: "black",
      title: "title",
    }),
  ],
  x: { axis: true, label: "periods" },
  y: { axis: false, label: "arms" },
  color: { legend: false },
  grid: true,
  marginLeft: 100,
  width: 400,
  height: 200,
})
return {designMatrixPlot};
}});

define({id: "ba4f4bc8", inputs: ["view","designMatrixPlot"], body: (view,designMatrixPlot) => {
view(designMatrixPlot)
}});

define({id: "d95dda4e", outputs: ["reduceTrialDesignTree"], body: () => {
function reduceTrialDesignTree(answers) {
  const trialDesignTree = {
    name: "",
    children: [
      {
        name: "Reversible outcome",
        children: [
          {
            name: "Rapid response",
            children: [
              {
                name: "",
                children: [
                  {
                    name: "Minimise time on placebo",
                    children: [
                      {
                        name: "Active treatment at the end",
                        children: [{ name: "DS, RPP, SW" }],
                      },
                      {
                        name: "No active treatment at the end",
                        children: [{ name: "RW, EE, 3S, AR" }],
                      },
                    ],
                  },
                  {
                    name: "Time on placebo not minimised",
                    children: [
                      {
                        name: "Intra-patient controls",
                        children: [{ name: "CO, LS, N1" }],
                      },
                      {
                        name: "Inter-patient controls",
                        children: [{ name: "PG, F" }],
                      },
                    ],
                  },
                ],
              },
            ],
          },
          {
            name: "Slow response",
            children: [
              {
                name: "Minimise time on placebo",
                children: [
                  {
                    name: "Active treatment at the end",
                    children: [{ name: "DS, RPP, SW" }],
                  },
                  {
                    name: "No active treatment at the end",
                    children: [{ name: "RW" }],
                  },
                ],
              },
              {
                name: "Time on placebo not minimised",
                children: [{ name: "PG, F" }],
              },
            ],
          },
        ],
      },
      {
        name: "Non-reversible outcome",
        children: [
          {
            name: "",
            children: [
              {
                name: "Rapid response",
                children: [
                  {
                    name: "Minimise time on placebo",
                    children: [
                      {
                        name: "Active treatment at the end",
                        children: [{ name: "RPP, SW" }],
                      },
                    ],
                  },
                  {
                    name: "Time on placebo not minimised",
                    children: [{ name: "PG, F" }],
                  },
                ],
              },
              {
                name: "Slow response",
                children: [
                  {
                    name: "Minimise time on placebo",
                    children: [{ name: "RPP, SW" }],
                  },
                  {
                    name: "Time on placebo not minimised",
                    children: [{ name: "PG, F" }],
                  },
                ],
              },
              {
                name: "Active treatment at the end",
                children: [{ name: "RPP, SW" }],
              },
              {
                name: "No active treatment at the end",
                children: [{ name: "AR" }],
              },
            ],
          },
        ],
      },
    ],
  }

  function traverseTree(node, answers) {
    if (answers.length === 0) {
      return node.children
        ? node.children.map((child) => ({ name: child.name }))
        : []
    }

    if (node.children) {
      let answer = answers.shift()
      for (let child of node.children) {
        if (child.name.includes(answer)) {
          return traverseTree(child, answers)
        }
      }

      // Recursively look down the tree if no matching child is found
      for (let child of node.children) {
        if (child.children) {
          let result = traverseTree(child, [answer, ...answers])
          if (result.length > 0) {
            return result
          }
        }
      }
    }
    return [] // Return an empty array if no match is found
  }

  let terminalNodes = traverseTree(trialDesignTree, [...answers])
  return terminalNodes
}
return {reduceTrialDesignTree};
}});

define({id: "0ffb14a5", outputs: ["translateTrialDesign"], body: () => {
function translateTrialDesign(nodes) {
  const trialDesignKey = {
    PG: "Parallel Groups",
    CO: "Cross-over",
    LS: "Latin square",
    F: "Factorial design",
    N1: "N-of-1",
    RPP: "Randomised placebo phase",
    SW: "Stepped wedge",
    RW: "Randomised withdrawal",
    EE: "Early escape",
    DS: "Delayed start",
    "3S": "Three stage",
    AR: "Adaptive randomization",
  }

  return nodes.map((node) => {
    const codes = node.name.split(", ")
    return codes.map((code) => trialDesignKey[code] || code).join(", ")
  })
}
return {translateTrialDesign};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Data Matters</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./">Introduction</a></li>
  </ol>
  <section class="observablehq-section-active">
    <summary>Experimental Design</summary>
    <ol>
    <li class="observablehq-link observablehq-link-active"><a href="./experimental-design">Experimental Design </a></li>
    <li class="observablehq-link"><a href="./parallel-arm-designs">Individual Randomized Parallel Designs</a></li>
    <li class="observablehq-link"><a href="./cluster-randomized-designs">Individual Randomized Cluster Designs</a></li>
    </ol>
  </section>
  <section>
    <summary>Data Science Experiments</summary>
    <ol>
    <li class="observablehq-link"><a href="./random-forest">Random Forests</a></li>
    <li class="observablehq-link"><a href="./mass-balance-business-models">Mass Balance Business Models</a></li>
    <li class="observablehq-link"><a href="./live-table-data">Live Tables</a></li>
    <li class="observablehq-link"><a href="./distp-demo">Distribution Modeling</a></li>
    </ol>
  </section>
  <section>
    <summary>Transport Modeling</summary>
    <ol>
    <li class="observablehq-link"><a href="./pbpk">Drug Elimination</a></li>
    </ol>
  </section>
  <section>
    <summary>Ukelele Modeling</summary>
    <ol>
    <li class="observablehq-link"><a href="./ukulele">Chord Maker</a></li>
    <li class="observablehq-link"><a href="./ukutabs/blackbird">Blackbird - The Beatles</a></li>
    </ol>
  </section>
  <section>
    <summary>Miscellaneous Visualizations</summary>
    <ol>
    <li class="observablehq-link"><a href="./happy-city">Is Minneapolis &#x27;happier&#x27; than Boston?</a></li>
    <li class="observablehq-link"><a href="./diddy-did-he">Diddy didn&#x27;t, did he?</a></li>
    <li class="observablehq-link"><a href="./fema-votes">FEMA Votes</a></li>
    </ol>
  </section>
  <section>
    <summary>Healthcare Diatribes</summary>
    <ol>
    <li class="observablehq-link"><a href="./stars-hedis-insanity">What are stars?</a></li>
    </ol>
  </section>
  <section>
    <summary>Self Aggrandizing</summary>
    <ol>
    <li class="observablehq-link"><a href="./podcasts">Podcasts &amp; Presentations</a></li>
    </ol>
  </section>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#a-flowchart">A flowchart</a></li>
<li class="observablehq-secondary-link"><a href="#visualizing-common-experimental-designs.">Visualizing common experimental designs.</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div id="cell-ba0d0f1d" class="observablehq observablehq--block"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.2/math.min.js"> </script>
<style>
    body {
    font: 13.5px/1.5 var(--serif);
    margin: 0;
    max-width: 90%;
    }

    table {
        border-collapse: collapse;
        table-layout:fixed;
        width: 100%;
        height: 20%;
        font: 13.5px/1.5 var(--serif);

    }
    th {
        font: 13.5px/1.5 var(--serif);
        font-weight: bold;
        border-top: 1px solid black;
        border-bottom: 1px solid black;
    }
    tr:last-child td {
        /* font-weight: bold; */
        border-bottom: 1px solid black;
        /* background-color: lightyellow; */
    }

    td, th {
        text-align: left;
        border-collapse: collapse;
        padding:2px;
        font-size:0.8em;
    }

    .horizontal-line {
    border-top: 0.5px solid #d3d3d3; /* Creates a thin gray line */
    width: 100%; /* Spans the width of the container/page */
    margin-top:10px;
    margin-bottom:10px
    }

    .katex { font-size: 1em; }

      p { max-width: 90% }


    </style>
<h1 id="choosing-an-experimental-design" tabindex="-1"><a class="observablehq-header-anchor" href="#choosing-an-experimental-design">Choosing an experimental design</a></h1>
<p>For me <em>measurement</em> is the essence of data science.</p>
<p>You say your model that has a higher prediction performance works better? <em>Prove it</em>.</p>
<p>You say your product drives more ROI or impact than your competitors? <em>Prove it</em>.</p>
<p>You say your new educational program improves student learning outcomes? <em>Prove it</em>.</p>
<p>In the pharmaceutical world, drugs are heavily examined through the drug development process. I think it's likely arguable that not all are tested under the best approaches (and many drugs are extremely difficult to test due to their operational constraints or targets) and some allowances need to be made. However, in almost every other clinical context (e.g., payer and vendor clinical products), most products are not well tested. There are some obvious counterpoints here, but you get the point. There are products that generate millions or even <em>tens of millions</em> in revenue and no one... and I mean no one, really knows if it actually <em>works</em>.</p>
<p>To this end, I've taken to dividing measurement into <em>credible</em> measurement and everything else. To credibly measure something is to look past all the marketing, product framing, and business logic, and truly figure out <em>does this thing actually work</em>. For products that are people-facing, I think it's super important that we change this. To this end, I've always wanted to write my own little guide to credible measurement. Not because I would do the math any differently (well, maybe), but because I've always wanted to simply write my thoughts on designing experiments.</p>
<h2 id="a-flowchart" tabindex="-1"><a class="observablehq-header-anchor" href="#a-flowchart">A flowchart</a></h2>
<p>This is a good resource for RCT Designs: <a href="https://link.springer.com/article/10.1186/1750-1172-8-48" target="_blank" rel="noopener noreferrer">Cornu et al., 2013</a></p>
<p>Within this article, there's a really interesting plot that I've recreated here. However, I've tried to make it a bit easier to navigate by asking a series of question (I'll probably dork this up).</p>
<div id="cell-1d46b041" class="observablehq observablehq--block"></div>
<div id="cell-2009b73c" class="observablehq observablehq--block"></div>
<div id="cell-a365d15f" class="observablehq observablehq--block"></div>
<div id="cell-413fe614" class="observablehq observablehq--block"></div>
<h2 id="visualizing-common-experimental-designs." tabindex="-1"><a class="observablehq-header-anchor" href="#visualizing-common-experimental-designs.">Visualizing common experimental designs.</a></h2>
<div id="cell-c934b0e6" class="observablehq observablehq--block"></div>
<div id="cell-d3fccb9f" class="observablehq observablehq--block"></div>
<div id="cell-bcf9577d" class="observablehq observablehq--block"></div>
<div id="cell-d56edcea" class="observablehq observablehq--block"></div>
<div id="cell-7709298f" class="observablehq observablehq--block"></div>
<div id="cell-ba4f4bc8" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<!-- Tree Visualizatinon and Selection -->
<div id="cell-d95dda4e" class="observablehq observablehq--block"></div>
<div id="cell-0ffb14a5" class="observablehq observablehq--block"></div>
<!--  Old flare plot

```js
const flare_cluster = Plot.plot({
  axis: null,
  inset: 10,
  marginLeft: 60,
  insetRight: 120,
  marginRight: 200,
  round: true,
  width: 500,
  height: 800,
  marks: Plot.tree(flare_flat, {
    treeSort: "node:height",
    textStroke: "white",
    treeLayout: indent,
    delimiter: "/",
    curve: "step-before",
  }),
});

view(flare_cluster);
``` -->
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./"><span>Data Matters</span></a><a rel="next" href="./parallel-arm-designs"><span>Individual Randomized Parallel Designs</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-11-17T16:41:47">Nov 17, 2024</a>.</div>
</footer>
</div>
