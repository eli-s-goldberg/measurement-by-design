<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Is Minneapolis &#x27;happier&#x27; than Boston? | Data Matters</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/d3@7/+esm">
<link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/d3-geo-projection@4/+esm">
<link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/d3-geo@3/+esm">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.15/_esm.js">
<link rel="modulepreload" href="./_npm/topojson-client@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/gunviolence-2024.csv", {"name":"./data/gunviolence-2024.csv","mimeType":"text/csv","path":"./_file/data/gunviolence-2024.fc8d394b.csv","lastModified":1719022895339});
registerFile("./data/happy_city_ranking.csv", {"name":"./data/happy_city_ranking.csv","mimeType":"text/csv","path":"./_file/data/happy_city_ranking.57ab4e43.csv","lastModified":1718582275794});
registerFile("./data/us-counties-10m.json", {"name":"./data/us-counties-10m.json","mimeType":"application/json","path":"./_file/data/us-counties-10m.145aaf5d.json","lastModified":1718560040679});

define({id: "396dd3f6", outputs: ["d3","geoPolyhedralWaterman","geoInterruptedHomolosine","geoCentroid"], body: async () => {
const [d3, {geoPolyhedralWaterman, geoInterruptedHomolosine}, {geoCentroid}] = await Promise.all([import("https://cdn.jsdelivr.net/npm/d3@7/+esm"), import("https://cdn.jsdelivr.net/npm/d3-geo-projection@4/+esm"), import("https://cdn.jsdelivr.net/npm/d3-geo@3/+esm")]);

return {d3,geoPolyhedralWaterman,geoInterruptedHomolosine,geoCentroid};
}});

define({id: "d4411bed", inputs: ["FileAttachment"], outputs: ["happycity","americanviolence","us"], body: (FileAttachment) => {
const happycity = FileAttachment("./data/happy_city_ranking.csv").csv({
  typed: true,
});

const americanviolence = FileAttachment("./data/gunviolence-2024.csv").csv({
  typed: true,
});

// 10M GEOJSON DATA
const us = FileAttachment("./data/us-counties-10m.json").json();
return {happycity,americanviolence,us};
}});

define({id: "79415116", inputs: ["happycity","nation","d3"], outputs: ["arrowDataUS"], body: (happycity,nation,d3) => {
// manipulate the happy city data to get the centroids. This doesn't need to be done but was a holdout from a seperate activity.
const arrowDataUS = happycity
  .filter((d) => d.country === "United States")
  .map((city) => {
    const country = nation.features.find(
      (feature) => feature.properties.name === city.country
    );
    const centroid = d3.geoCentroid(country);
    return {
      country: city.country,
      cityName: city.city,
      centroidLon: -98.5833,
      centroidLat: 39.8333,
      cityLon: city.longitude,
      cityLat: city.latitude,
      rank: city.rank,
    };
  });
return {arrowDataUS};
}});

define({id: "fcb51b85", inputs: ["topojson","us"], outputs: ["nation","statemesh"], body: (topojson,us) => {
const nation = topojson.feature(us, us.objects.nation);
const statemesh = topojson.mesh(us, us.objects.states);
return {nation,statemesh};
}});

define({id: "6ee06d52", inputs: ["arrowDataUS"], outputs: ["washingtonDC","baltimore","remainingData"], body: (arrowDataUS) => {
// Extract data for Washington D.C.
const washingtonDC = arrowDataUS.filter(
  (d) => d.cityName === "Washington D.C"
)[0];

// Extract data for Baltimore
const baltimore = arrowDataUS.filter((d) => d.cityName === "Baltimore")[0];

// Exclude Washington D.C. and Baltimore from the original data
const remainingData = arrowDataUS.filter(
  (d) => d.cityName !== "Washington D.C" && d.cityName !== "Baltimore"
);
return {washingtonDC,baltimore,remainingData};
}});

define({id: "a8a5d628", outputs: ["slice","take"], body: () => {
function slice(...options) {
  return (array) => array.slice(...options);
}

function take(values, index) {
  return values.constructor.from(index, (i) => values[i]);
}
return {slice,take};
}});

define({id: "adb810e9", inputs: ["Plot","remainingData","baltimore","washingtonDC","nation","statemesh","happycity","view"], outputs: ["americal_happiness_plot"], body: (Plot,remainingData,baltimore,washingtonDC,nation,statemesh,happycity,view) => {
const americal_happiness_plot = Plot.plot({
  projection: "albers-usa",
  color: {
    type: "categorical",
    domain: ["bronze", "silver", "gold"],
    range: ["#CD7F32", "silver", "gold"],
    legend: true,
  },
  inset: 10,
  marks: [
    // Plot.frame(),
    Plot.text(remainingData, {
      x: "cityLon",
      y: "cityLat",
      text: "cityName",
      textAnchor: "start",
      // dy: -10,
      dx: 10,
      fontSize: 12,
      fill: "black",
      stroke: "white",
      strokeWidth: 3,
    }),
    Plot.text([baltimore], {
      x: "cityLon",
      y: "cityLat",
      text: "cityName",
      textAnchor: "start",
      dx: 10,
      fontSize: 12,
      fill: "black",
      stroke: "white",
      strokeWidth: 3,
    }),
    Plot.text([washingtonDC], {
      x: "cityLon",
      y: "cityLat",
      text: "cityName",
      textAnchor: "start",
      dy: 10,
      dx: 10,
      fontSize: 12,
      fill: "black",
      stroke: "white",
      strokeWidth: 3,
    }),

    Plot.geo(nation, { strokeOpacity: 0.6 }),
    Plot.geo(statemesh, { stroke: "black", strokeOpacity: 0.2 }),
    Plot.dot(
      happycity.filter((d) => d.country === "United States"),
      {
        x: "longitude",
        y: "latitude",
        fill: "rank",
        stroke: "black",
        strokeWidth: 0.5,
        r: 5,
        fillOpacity: 1,
      }
    ),
  ],
});

view(americal_happiness_plot);
return {americal_happiness_plot};
}});

define({id: "b1859289", outputs: ["rankColors"], body: () => {
const rankColors = {
  bronze: "#CD7F32",
  silver: "silver",
  gold: "gold",
};
return {rankColors};
}});

define({id: "7cbce11d", inputs: ["Plot","americanviolence","bandwidth","thresholds","violence_metric","remainingData","rankColors","baltimore","washingtonDC","nation","statemesh","view"], outputs: ["violence_plot"], body: (Plot,americanviolence,bandwidth,thresholds,violence_metric,remainingData,rankColors,baltimore,washingtonDC,nation,statemesh,view) => {
const violence_plot = Plot.plot({
  projection: "albers",
  color: {
    scheme: "Viridis",
    // type: "quantize",
    legend: true,
    opacity: 0.6,
  },
  inset: 10,
  marks: [
    Plot.density(americanviolence, {
      x: "longitude",
      y: "latitude",
      strokeWidth: 0.5,
      stroke: "black",
      bandwidth: bandwidth,
      thresholds: thresholds,
      strokeOpacity: 0.0,
      weight: violence_metric,
      fill: "density",
      fillOpacity: 0.2,
      clip: true,
    }),
    // Plot.frame(),
    Plot.dot(americanviolence, {
      x: "longitude",
      y: "latitude",
      r: (d) => d[violence_metric],
      fill: "red",
      stroke: null,
      fillOpacity: 0.1,
    }),
    Plot.dot(remainingData, {
      x: "cityLon",
      y: "cityLat",
      r: 5,
      fill: (d) => rankColors[d.rank], // Apply custom color scheme
      stroke: "black",
      strokeWidth: 0.5,
    }),
    Plot.dot([baltimore], {
      x: "cityLon",
      y: "cityLat",
      r: 5,
      fill: (d) => rankColors[d.rank], // Apply custom color scheme
      stroke: "black",
      strokeWidth: 0.5,
    }),
    Plot.dot([washingtonDC], {
      x: "cityLon",
      y: "cityLat",
      r: 5,
      fill: (d) => rankColors[d.rank], // Apply custom color scheme
      stroke: "black",
      strokeWidth: 0.5,
    }),

    Plot.text(remainingData, {
      x: "cityLon",
      y: "cityLat",
      text: "cityName",
      textAnchor: "start",
      // dy: -10,
      dx: 10,
      fontSize: 12,
      fill: "black",
      stroke: "white",
      strokeWidth: 3,
    }),
    Plot.text([baltimore], {
      x: "cityLon",
      y: "cityLat",
      text: "cityName",
      textAnchor: "start",
      dx: 10,
      fontSize: 12,
      fill: "black",
      stroke: "white",
      strokeWidth: 3,
    }),
    Plot.text([washingtonDC], {
      x: "cityLon",
      y: "cityLat",
      text: "cityName",
      textAnchor: "start",
      dy: 10,
      dx: 10,
      fontSize: 12,
      fill: "black",
      stroke: "white",
      strokeWidth: 3,
    }),
    Plot.geo(nation, { strokeOpacity: 0.6 }),
    Plot.geo(statemesh, { stroke: "green", strokeOpacity: 0.2 }),
  ],
});
view(violence_plot);
return {violence_plot};
}});

define({id: "6bd3cad6", inputs: ["view","Inputs"], outputs: ["bandwidth","thresholds","violence_metric"], body: (view,Inputs) => {
const bandwidth = view(
  Inputs.range([0, 40], { step: 0.25, label: "bandwidth", value: 20 })
);
const thresholds = view(
  Inputs.range([0, 100], { step: 0.5, label: "thresholds", value: 10 })
);

const violence_metric = view(
  Inputs.radio(
    [
      "Victims Killed",
      "Victims Injured",
      "Suspects Killed",
      "Suspects Injured",
      "Suspects Arrested",
    ],
    { label: "Metric", value: "Suspects Injured" }
  )
);
return {bandwidth,thresholds,violence_metric};
}});

define({id: "6740893c", inputs: ["americanviolence"], outputs: ["aggregatedData","aggregatedDataRes","longFormatData"], body: (americanviolence) => {
// aggregating by city
const aggregatedData = {};

// Iterate through the dataset
americanviolence.forEach((entry) => {
  const city = entry["City Or County"];
  const lat = entry["latitude"];
  const long = entry["longitude"];
  const date = entry["Incident Date"];

  // Initialize the city in the aggregatedData object if it doesn't exist
  if (!aggregatedData[city]) {
    aggregatedData[city] = {
      City: city,
      "Victims Killed": 0,
      "Victims Injured": 0,
      "Suspects Killed": 0,
      "Suspects Injured": 0,
      "Suspects Arrested": 0,
      latitude: lat,
      longitude: long,
      date: date,
    };
  }

  // Sum the values for each metric
  aggregatedData[city]["Victims Killed"] += entry["Victims Killed"];
  aggregatedData[city]["Victims Injured"] += entry["Victims Injured"];
  aggregatedData[city]["Suspects Killed"] += entry["Suspects Killed"];
  aggregatedData[city]["Suspects Injured"] += entry["Suspects Injured"];
  aggregatedData[city]["Suspects Arrested"] += entry["Suspects Arrested"];
});

const aggregatedDataRes = Object.values(aggregatedData);

const longFormatData = [];
aggregatedDataRes.forEach((cityData) => {
  Object.keys(cityData).forEach((key) => {
    if (key !== "City" && key !== "latitude" && key !== "longitude") {
      longFormatData.push({
        City: cityData["City"],
        latitude: cityData["latitude"],
        longitude: cityData["longitude"],
        violence_metric: key,
        value: cityData[key],
      });
    }
  });
});
return {aggregatedData,aggregatedDataRes,longFormatData};
}});

define({id: "3d84a674", inputs: ["americanviolence"], outputs: ["aggregatedDataDate","timeSeriesData"], body: (americanviolence) => {
// Parse the dates and aggregate incidents by date and city for each metric
const aggregatedDataDate = {};

americanviolence.forEach((entry) => {
  const date = new Date(entry["Incident Date"]).toISOString().split("T")[0];
  const city = entry["City Or County"];

  if (!aggregatedDataDate[city]) {
    aggregatedDataDate[city] = {};
  }
  if (!aggregatedDataDate[city][date]) {
    aggregatedDataDate[city][date] = {
      incidents: 0,
      victimsKilled: 0,
      victimsInjured: 0,
      suspectsKilled: 0,
      suspectsInjured: 0,
      suspectsArrested: 0,
    };
  }

  aggregatedDataDate[city][date].incidents += 1;
  aggregatedDataDate[city][date].victimsKilled += entry["Victims Killed"];
  aggregatedDataDate[city][date].victimsInjured += entry["Victims Injured"];
  aggregatedDataDate[city][date].suspectsKilled += entry["Suspects Killed"];
  aggregatedDataDate[city][date].suspectsInjured += entry["Suspects Injured"];
  aggregatedDataDate[city][date].suspectsArrested += entry["Suspects Arrested"];
});

// Convert the aggregated data into a long format array suitable for plotting
const timeSeriesData = [];

Object.keys(aggregatedDataDate).forEach((city) => {
  let cumulativeVictimsKilled = 0;
  let cumulativeVictimsInjured = 0;
  let cumulativeSuspectsKilled = 0;
  let cumulativeSuspectsInjured = 0;
  let cumulativeSuspectsArrested = 0;

  Object.keys(aggregatedDataDate[city])
    .sort((a, b) => new Date(a) - new Date(b))
    .forEach((date) => {
      const entry = aggregatedDataDate[city][date];
      cumulativeVictimsKilled += entry.victimsKilled;
      cumulativeVictimsInjured += entry.victimsInjured;
      cumulativeSuspectsKilled += entry.suspectsKilled;
      cumulativeSuspectsInjured += entry.suspectsInjured;
      cumulativeSuspectsArrested += entry.suspectsArrested;

      timeSeriesData.push({
        city: city,
        date: new Date(date),
        metric: "Victims Killed",
        value: cumulativeVictimsKilled,
      });
      timeSeriesData.push({
        city: city,
        date: new Date(date),
        metric: "Victims Injured",
        value: cumulativeVictimsInjured,
      });
      timeSeriesData.push({
        city: city,
        date: new Date(date),
        metric: "Suspects Killed",
        value: cumulativeSuspectsKilled,
      });
      timeSeriesData.push({
        city: city,
        date: new Date(date),
        metric: "Suspects Injured",
        value: cumulativeSuspectsInjured,
      });
      timeSeriesData.push({
        city: city,
        date: new Date(date),
        metric: "Suspects Arrested",
        value: cumulativeSuspectsArrested,
      });
    });
});

timeSeriesData.sort((a, b) => a.date - b.date);
return {aggregatedDataDate,timeSeriesData};
}});

define({id: "bac60f96", inputs: ["Plot","longFormatData","view"], outputs: ["violence_by_city"], body: (Plot,longFormatData,view) => {
const violence_by_city = Plot.plot({
  marginLeft: 90,
  x: { label: null, axis: false },
  y: { label: null },
  facet: {
    data: longFormatData,
    x: "violence_metric",
    axis: true,
  },
  fx: {
    label: null,
    padding: 0.3,
    domain: [
      "Suspects Arrested",
      "Suspects Injured",
      "Suspects Killed",
      "Victims Injured",
      "Victims Killed",
    ],
  },
  marks: [
    Plot.barX(longFormatData, {
      y: "City",
      x: "value",
      fill: (d) =>
        d.City === "Boston" || d.City === "Minneapolis" ? "red" : "steelblue",
      sort: { y: "x", reverse: true, limit: 60 },
    }),
    Plot.text(longFormatData, {
      y: "City",
      x: "value",
      text: (d) => d.value,

      fill: (d) =>
        d.City === "Boston" || d.City === "Minneapolis" ? "red" : "black",
      dx: 12,
    }),
  ],
});

view(violence_by_city);
return {violence_by_city};
}});

define({id: "277fce08", inputs: ["Plot","timeSeriesData","view"], outputs: ["timeSeriesPlot"], body: (Plot,timeSeriesData,view) => {
const timeSeriesPlot = Plot.plot({
  x: {
    label: "Date",

    type: "time",
  },
  y: {
    label: "Number of Incidents",
    domain: [0, 105],
  },
  color: { legend: true },
  inset: 20,
  marginRight: 100,
  fx: { label: "" },
  marks: [
    Plot.lineY(timeSeriesData, {
      x: "date",
      y: "value",
      fx: "metric",
      stroke: (d) => (d.city === "Minneapolis" ? "red" : null),
    }),

    Plot.line(timeSeriesData, {
      x: "date",
      y: "value",
      fx: "metric",
      stroke: (d) => (d.city === "Boston" ? "green" : null),
    }),
  ],
});

view(timeSeriesPlot);
return {timeSeriesPlot};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Data Matters</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./">Introduction</a></li>
  </ol>
  <section>
    <summary>Experimental Design</summary>
    <ol>
    <li class="observablehq-link"><a href="./experimental-design">Experimental Design </a></li>
    <li class="observablehq-link"><a href="./parallel-arm-designs">Individual Randomized Parallel Designs</a></li>
    <li class="observablehq-link"><a href="./cluster-randomized-designs">Individual Randomized Cluster Designs</a></li>
    </ol>
  </section>
  <section>
    <summary>Data Science Experiments</summary>
    <ol>
    <li class="observablehq-link"><a href="./random-forest">Random Forests</a></li>
    <li class="observablehq-link"><a href="./mass-balance-business-models">Mass Balance Business Models</a></li>
    <li class="observablehq-link"><a href="./live-table-data">Live Tables</a></li>
    <li class="observablehq-link"><a href="./distp-demo">Distribution Modeling</a></li>
    </ol>
  </section>
  <section>
    <summary>Transport Modeling</summary>
    <ol>
    <li class="observablehq-link"><a href="./pbpk">Drug Elimination</a></li>
    </ol>
  </section>
  <section>
    <summary>Ukelele Modeling</summary>
    <ol>
    <li class="observablehq-link"><a href="./ukulele">Chord Maker</a></li>
    <li class="observablehq-link"><a href="./ukutabs/blackbird">Blackbird - The Beatles</a></li>
    </ol>
  </section>
  <section class="observablehq-section-active">
    <summary>Miscellaneous Visualizations</summary>
    <ol>
    <li class="observablehq-link observablehq-link-active"><a href="./happy-city">Is Minneapolis &#x27;happier&#x27; than Boston?</a></li>
    <li class="observablehq-link"><a href="./diddy-did-he">Diddy didn&#x27;t, did he?</a></li>
    <li class="observablehq-link"><a href="./fema-votes">FEMA Votes</a></li>
    </ol>
  </section>
  <section>
    <summary>Healthcare Diatribes</summary>
    <ol>
    <li class="observablehq-link"><a href="./stars-hedis-insanity">What are stars?</a></li>
    </ol>
  </section>
  <section>
    <summary>Self Aggrandizing</summary>
    <ol>
    <li class="observablehq-link"><a href="./podcasts">Podcasts &amp; Presentations</a></li>
    </ol>
  </section>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#what-is-the-happy-city-index%3F">What is the Happy City Index?</a></li>
<li class="observablehq-secondary-link"><a href="#all-the-happiness-are-belong-to-us">All the happiness are belong to us</a></li>
<li class="observablehq-secondary-link"><a href="#conclusion">Conclusion</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div id="cell-396dd3f6" class="observablehq observablehq--block"></div>
<script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>
<!-- FORMATTING -->
<style>
      body {
      font: 13.5px/1.5 var(--serif);
      margin: 0;
      max-width: 90%;
      }

      table {
          border-collapse: collapse;
          table-layout:fixed;
          width: 100%;
          height: 20%;
          font: 13.5px/1.5 var(--serif);

      }
      th {
          font: 13.5px/1.5 var(--serif);
          font-weight: bold;
          border-top: 1px solid black;
          border-bottom: 1px solid black;
    }
    tr:last-child td {
        /* font-weight: bold; */
        border-bottom: 1px solid black;
        /* background-color: lightyellow; */
    }
    /* tr:nth-last-child(2) {
        border-bottom: 1px dashed black;
    } */
    td, th {
        text-align: left;
        border-collapse: collapse;
        padding:2px;
        font-size:0.8em;
    }

    .horizontal-line {
    border-top: 0.5px solid #d3d3d3; /* Creates a thin gray line */
    width: 100%; /* Spans the width of the container/page */
    margin-top:10px;
    margin-bottom:10px
    }

    .katex { font-size: 1em; }

      p { max-width: 90% }


</style>
<!-- IMPORT DATA -->
<div id="cell-d4411bed" class="observablehq observablehq--block"></div>
<div id="cell-79415116" class="observablehq observablehq--block"></div>
<div id="cell-fcb51b85" class="observablehq observablehq--block"></div>
<div id="cell-6ee06d52" class="observablehq observablehq--block"></div>
<!-- GENERIC FUNCTIONS -->
<div id="cell-a8a5d628" class="observablehq observablehq--block"></div>
<h1 id="is-minneapolis-'happier'-than-boston%3F" tabindex="-1"><a class="observablehq-header-anchor" href="#is-minneapolis-'happier'-than-boston%3F">Is Minneapolis 'happier' than Boston?</a></h1>
<p>So, this is a terrible title, but do let me explain. Recently, a close friend recently forwarded me the "happy city index" rankings. His contention was that Minneaplis, which is a 'gold' ranked city, is better than Boston, which is a 'silver' ranked city. I thought I would dig in a bit as it's an interesting dataset and give some thoughts.</p>
<h2 id="what-is-the-happy-city-index%3F" tabindex="-1"><a class="observablehq-header-anchor" href="#what-is-the-happy-city-index%3F">What is the Happy City Index?</a></h2>
<p>The <a href="https://happy-city-index.com/" target="_blank" rel="noopener noreferrer">Happy City Index</a> ranks cities based on happiness-related factors like education, inclusive policies, economy, mobility, environmental protection, and access to green areas. It emphasizes that happiness varies greatly by demographic and that no single city can be deemed the happiest. Instead, it highlights a group of cities committed to enhancing residents' quality of life. Rankings and detailed scores for numerous cities are provided annually.</p>
<p>The index methods are somewhat opaque and, to be honest, I am extremely skeptical of Boston's ratings. In particular, the lower economic and mobility scores are a little surprising. However, I'm not about to entirely redo their analysis (although I'm occasionally super vindictive, so I reserve the right to do so in the future). That said, let's add in some additional data to rationalize and offer another angle to the Minneapolis superiority argument.</p>
<h2 id="all-the-happiness-are-belong-to-us" tabindex="-1"><a class="observablehq-header-anchor" href="#all-the-happiness-are-belong-to-us">All the happiness are belong to us</a></h2>
<p>Here's the location and 'rank' for the American cities. Madison is bronze, which is suprising. There's a lot of silber on the east coast, in general. Also, salt lake city is a kind of a shock, as well, but I'll refrain from commenting my thoughts on <em>why</em>.</p>
<div id="cell-adb810e9" class="observablehq observablehq--block"></div>
<p>Ok. That's cool and all, but I'm curious. What if we were to look at gun violence as a category?</p>
<p>To do so, let's create a density plot using the location and mass shooting statistics to see if we think differently. Data is available for download from the <a href="https://www.gunviolencearchive.org/" target="_blank" rel="noopener noreferrer">Gun Violence Archive</a>.</p>
<div class="warning">
<p>NOTE: I'm only grabbing mass shootings across the US in whatever order the Gun Violence Archive people think is appropriate. Also, I'm limiting myself to ~2000 incidents in total, because while I like messing with my friends, it's not worth eating up too much money geocoding locations.</p>
</div>
<div id="cell-b1859289" class="observablehq observablehq--block"></div>
<div id="cell-7cbce11d" class="observablehq observablehq--block"></div>
<p>Play with these to tweak the viz. Slide the thresholds to '0' to see the location of each event.</p>
<div id="cell-6bd3cad6" class="observablehq observablehq--block"></div>
<h3 id="aggregated-data-by-city" tabindex="-1"><a class="observablehq-header-anchor" href="#aggregated-data-by-city">Aggregated Data by City</a></h3>
<div id="cell-6740893c" class="observablehq observablehq--block"></div>
<div id="cell-3d84a674" class="observablehq observablehq--block"></div>
<p>Ok. So, despite that this chart is quite quantitative, it's somehow <em>unsatisfying</em> for understanding a direct comparison in violence between cities. Noting that the populaton differences between these two metropolitan areas is relatively similar:</p>
<ul>
<li><a href="https://www.census.gov/quickfacts/fact/table/bostoncitymassachusetts,US/POP010220" target="_blank" rel="noopener noreferrer">Boston had a population of 675,647 in the 2020 census</a></li>
<li><a href="https://www.census.gov/quickfacts/fact/dashboard/minneapoliscityminnesota,hennepincountyminnesota/PST045221" target="_blank" rel="noopener noreferrer">Minneapolis had a population of 429,954 in the 2020 census</a></li>
</ul>
<p>Now, it's likely that I didn't grab <em>all</em> the data from the gun violence archive (I only did the most recent 2000 incidents), but it does appear that things are not trending super well for Minneapolis in comparison to Boston this year.</p>
<div id="cell-bac60f96" class="observablehq observablehq--block"></div>
<p>Let's take a look at how our two cities are stacking up over time.</p>
<div id="cell-277fce08" class="observablehq observablehq--block"></div>
<p><b>Ouch.</b> Minneapolis definetly leads Boston in Mass shootings with respect to victims injured, killed, and suspects injured. I will note that boston does lead in suspects arresed and injured, but somehow that seems less terrible...but only slightly.</p>
<p>I'll note further that I could have calculated this per capita, but the reality is that I think this would make it look even <em>worse</em> for Minneapolis, as it has a lower population and worse mass shooting stats than Boston.</p>
<h2 id="conclusion" tabindex="-1"><a class="observablehq-header-anchor" href="#conclusion">Conclusion</a></h2>
<p>I'll admit that it's not an <em>overwhelming</em> win for Boston re: mass shootings and gun violence, Boston definetly does win in the "mass shooting" category. The fact that I even have to consider this makes me physically ill. I want off this American timeline or we'll end up in the Star Wars universe instead of the <em>Star Trek</em> universe.</p>
<div class="horizontal-line ">
<h3 id="methods" tabindex="-1"><a class="observablehq-header-anchor" href="#methods">Methods</a></h3>
<p>Most of the methods are available by inspecting the <code>js</code> associated with this github repo's markdown.</p>
<p>For those of you who were interested in how I was using the GoogleAPI to automate geocoding of locations. Here's my full AppScript (sans my API key).</p>
<pre data-language="javascript"><code class="language-javascript"><span class="hljs-keyword">var</span> apiKey = <span class="hljs-string">"YOURAPIKEY"</span>; <span class="hljs-comment">// Replace with your actual API key</span>
<span class="hljs-keyword">var</span> cache = <span class="hljs-title class_">CacheService</span>.<span class="hljs-title function_">getScriptCache</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">GOOGLEMAPS_LATLONG</span>(<span class="hljs-params">address, city, state</span>) {
  <span class="hljs-keyword">var</span> fullAddress = address + <span class="hljs-string">", "</span> + city + <span class="hljs-string">", "</span> + state + <span class="hljs-string">", USA"</span>;
  <span class="hljs-keyword">var</span> cached = cache.<span class="hljs-title function_">get</span>(fullAddress);
  <span class="hljs-keyword">if</span> (cached) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(cached);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">var</span> response = <span class="hljs-title class_">UrlFetchApp</span>.<span class="hljs-title function_">fetch</span>(
        <span class="hljs-string">"https://maps.googleapis.com/maps/api/geocode/json?address="</span> +
          <span class="hljs-built_in">encodeURIComponent</span>(fullAddress) +
          <span class="hljs-string">"&amp;key="</span> +
          apiKey
      );
      <span class="hljs-keyword">var</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-title function_">getContentText</span>());
      <span class="hljs-keyword">if</span> (json.<span class="hljs-property">status</span> == <span class="hljs-string">"OK"</span> &amp;&amp; json.<span class="hljs-property">results</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">var</span> lat = json.<span class="hljs-property">results</span>[<span class="hljs-number">0</span>].<span class="hljs-property">geometry</span>.<span class="hljs-property">location</span>.<span class="hljs-property">lat</span>;
        <span class="hljs-keyword">var</span> lng = json.<span class="hljs-property">results</span>[<span class="hljs-number">0</span>].<span class="hljs-property">geometry</span>.<span class="hljs-property">location</span>.<span class="hljs-property">lng</span>;
        <span class="hljs-keyword">var</span> result = [lat, lng];
        cache.<span class="hljs-title function_">put</span>(fullAddress, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result), <span class="hljs-number">21600</span>); <span class="hljs-comment">// Cache for 6 hours</span>
        <span class="hljs-keyword">return</span> result;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> [<span class="hljs-string">"Not Found"</span>, <span class="hljs-string">"Not Found"</span>];
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> [<span class="hljs-string">"Error"</span>, <span class="hljs-string">"Error"</span>];
    }
  }
}
</code></pre>
<p>In the google sheet, and assuning that <code>address</code> is in Column A and <code>city</code> is in Column B, and <code>state</code> is in Column C, you can extract the latitude and longitude as such:</p>
<ul>
<li>Latitude: <code>=INDEX(GOOGLEMAPS_LATLONG(A1, B1, C1), 1)</code></li>
<li>Longitude: <code>=INDEX(GOOGLEMAPS_LATLONG(A1, B1, C1), 2)</code></li>
</ul>
</div></main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./ukutabs/blackbird"><span>Blackbird - The Beatles</span></a><a rel="next" href="./diddy-did-he"><span>Diddy didn&#x27;t, did he?</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-11-17T16:41:47">Nov 17, 2024</a>.</div>
</footer>
</div>
